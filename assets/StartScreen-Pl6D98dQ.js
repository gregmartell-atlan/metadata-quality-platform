import{H as U,r as s,aV as v,aW as V,aX as X,j as t,aY as Y,aZ as Z,a_ as z}from"./index-BYXjn4hA.js";import{c as B,i as J}from"./v2Api-zEssVn_2.js";const P=[{id:"ai_rag",name:"AI RAG",group:"AI"},{id:"ai_agent",name:"Agent Workflows",group:"AI"},{id:"ai_forecast",name:"Forecasting",group:"AI"},{id:"data_lineage",name:"Lineage",group:"DATA"},{id:"data_ownership",name:"Ownership",group:"DATA"},{id:"data_semantics",name:"Semantics",group:"DATA"},{id:"data_quality",name:"Quality & Freshness",group:"DATA"},{id:"data_security",name:"Sensitivity & Access",group:"DATA"}];function ae(){const T=U(),[g,p]=s.useState(""),[f,o]=s.useState(""),[b,$]=s.useState(""),[u,I]=s.useState([]),[y,C]=s.useState(!1),[n,S]=s.useState("domain"),[r,A]=s.useState(!1),[w,D]=s.useState([]),[k,F]=s.useState([]),[q,Q]=s.useState([]),[O,j]=s.useState([]),[i,N]=s.useState(""),[c,m]=s.useState(null),[h,L]=s.useState(!1),[x,R]=s.useState(!1),[M,_]=s.useState(!1),[W,E]=s.useState(!1),d=s.useCallback(async()=>{const e=v();if(A(a=>a!==e?e:a),e){L(!0);try{const a=await Z();D(a),console.log("[StartScreen] Fetched domains:",a.length)}catch(a){console.error("[StartScreen] Failed to fetch domains:",a)}finally{L(!1)}R(!0);try{const a=await z();F(a),console.log("[StartScreen] Fetched connectors:",a.length)}catch(a){console.error("[StartScreen] Failed to fetch connectors:",a)}finally{R(!1)}}else D([]),F([])},[]);s.useEffect(()=>{d()},[d]),s.useEffect(()=>{const e=setInterval(()=>{const a=v();A(l=>l!==a?(d(),a):l)},2e3);return()=>clearInterval(e)},[d]),s.useEffect(()=>{i&&n==="connection"&&(_(!0),Q([]),j([]),m(null),o(""),V(i).then(e=>{Q(e)}).catch(e=>{console.error("Failed to fetch databases:",e)}).finally(()=>{_(!1)}))},[i,n]),s.useEffect(()=>{c&&n==="connection"&&(E(!0),j([]),o(""),X(c.qualifiedName).then(e=>{j(e)}).catch(e=>{console.error("Failed to fetch schemas:",e)}).finally(()=>{E(!1)}))},[c,n]);const G=e=>{I(a=>a.includes(e)?a.filter(l=>l!==e):[...a,e])},H=async()=>{C(!0);try{let e;n==="domain"&&g?e={domainQualifiedName:g}:n==="connection"?f?e={schemaQualifiedName:f}:c?e={connectionQualifiedName:c.qualifiedName}:i&&(e={query:`connectorName:${i}`}):n==="query"&&b&&(e={query:b});const a=await B(e,u);if(v())try{const l=Y();l&&(console.log("[StartScreen] Auto-triggering ingestion for new run..."),J(a.id,l.baseUrl,l.apiKey).catch(K=>{console.error("[StartScreen] Failed to start ingestion:",K)}))}catch(l){console.error("[StartScreen] Failed to trigger ingestion:",l)}T(`/app/v2/run/${a.id}`)}catch{alert("Failed to start run")}finally{C(!1)}};return t.jsxs("main",{className:"max-w-2xl mx-auto py-8 sm:py-12 px-4 sm:px-0","aria-labelledby":"start-run-title",children:[t.jsx("h1",{id:"start-run-title",className:"text-3xl font-bold mb-8",children:"New Assessment Run"}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-4 mb-4 flex-wrap",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"scope-mode",checked:n==="domain",onChange:()=>{S("domain"),o(""),N(""),m(null)},className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Domain"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"scope-mode",checked:n==="connection",onChange:()=>{S("connection"),p("")},className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Connection/Schema"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"scope-mode",checked:n==="query",onChange:()=>{S("query"),p(""),o(""),N(""),m(null)},className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Query String"})]})]}),n==="domain"?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{htmlFor:"run-domain",className:"block text-sm font-medium text-gray-700",children:["Atlan Data Domain ",!r&&"(Connect to Atlan to see domains)"]}),r&&t.jsx("button",{type:"button",onClick:d,disabled:h,className:"text-xs text-blue-600 hover:text-blue-800 disabled:text-gray-400",title:"Refresh domains",children:h?"Loading...":"Refresh"})]}),r?t.jsxs("select",{id:"run-domain",className:"w-full border rounded-md p-2",value:g,onChange:e=>p(e.target.value),"aria-describedby":"run-domain-help","data-testid":"run-domain-select",disabled:h,children:[t.jsx("option",{value:"",children:"-- Select a domain (optional) --"}),w.length===0&&!h?t.jsx("option",{value:"",disabled:!0,children:"No domains found"}):w.map(e=>t.jsx("option",{value:e.qualifiedName,children:e.name},e.guid))]}):t.jsx("div",{className:"w-full border rounded-md p-2 bg-gray-50 text-gray-500 text-sm",children:"Connect to Atlan to select domains"}),t.jsx("p",{id:"run-domain-help",className:"text-xs text-gray-500 mt-1",children:"Select an Atlan Data Domain to assess assets within that domain boundary"})]}):n==="connection"?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{htmlFor:"run-connector",className:"block text-sm font-medium text-gray-700",children:["Connector ",!r&&"(Connect to Atlan to see connectors)"]}),r&&t.jsx("button",{type:"button",onClick:d,disabled:x,className:"text-xs text-blue-600 hover:text-blue-800 disabled:text-gray-400",title:"Refresh connectors",children:x?"Loading...":"Refresh"})]}),r?t.jsxs("select",{id:"run-connector",className:"w-full border rounded-md p-2",value:i,onChange:e=>{N(e.target.value),m(null),o("")},disabled:x,"data-testid":"run-connector-select",children:[t.jsx("option",{value:"",children:"-- Select a connector (optional) --"}),k.length===0&&!x?t.jsx("option",{value:"",disabled:!0,children:"No connectors found"}):k.map(e=>t.jsxs("option",{value:e.name,children:[e.name," (",e.assetCount," assets)"]},e.id))]}):t.jsx("div",{className:"w-full border rounded-md p-2 bg-gray-50 text-gray-500 text-sm",children:"Connect to Atlan to select connectors"})]}),i&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"run-database",className:"block text-sm font-medium text-gray-700 mb-2",children:"Database (Optional)"}),t.jsxs("select",{id:"run-database",className:"w-full border rounded-md p-2",value:c?.guid||"",onChange:e=>{const a=q.find(l=>l.guid===e.target.value);m(a||null),o("")},disabled:M,"data-testid":"run-database-select",children:[t.jsx("option",{value:"",children:"-- Select a database (optional) --"}),q.map(e=>t.jsxs("option",{value:e.guid,children:[e.name," ",e.childCount!==void 0&&`(${e.childCount} schemas)`]},e.guid))]})]}),c&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"run-schema",className:"block text-sm font-medium text-gray-700 mb-2",children:"Schema (Optional)"}),t.jsxs("select",{id:"run-schema",className:"w-full border rounded-md p-2",value:f,onChange:e=>o(e.target.value),disabled:W,"data-testid":"run-schema-select",children:[t.jsx("option",{value:"",children:"-- Select a schema (optional) --"}),O.map(e=>t.jsxs("option",{value:e.qualifiedName,children:[e.name," ",e.childCount!==void 0&&`(${e.childCount} objects)`]},e.guid))]})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"Select a connector, database, or schema to scope the assessment"})]}):t.jsxs("div",{children:[t.jsx("label",{htmlFor:"run-scope",className:"block text-sm font-medium text-gray-700 mb-2",children:"Scope Query (Optional)"}),t.jsx("input",{id:"run-scope",type:"text",className:"w-full border rounded-md p-2",placeholder:"e.g. domain:Sales OR type:Table",value:b,onChange:e=>$(e.target.value),"aria-describedby":"run-scope-help","data-testid":"run-scope-input"}),t.jsx("p",{id:"run-scope-help",className:"text-xs text-gray-500 mt-1",children:"Elasticsearch query string for asset filtering"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Capabilities"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",role:"list",children:P.map(e=>t.jsxs("button",{type:"button",onClick:()=>G(e.id),className:`p-4 border rounded-lg cursor-pointer transition-colors ${u.includes(e.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,"aria-pressed":u.includes(e.id),"aria-label":`${e.name} capability`,"data-testid":`capability-${e.id}`,children:[t.jsx("div",{className:"font-medium",children:e.name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.group})]},e.id))})]}),t.jsx("button",{onClick:H,disabled:y||u.length===0,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50","aria-disabled":y||u.length===0,"data-testid":"start-assessment",children:y?"Starting...":"Start Assessment"})]})]})}export{ae as StartScreen};
