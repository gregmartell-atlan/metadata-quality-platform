import{d as x,bl as U,p as $,bm as j,b7 as y}from"./index-BYXjn4hA.js";const W=[{category:"SQL",displayName:"SQL",description:"Relational database assets",color:"#3B82F6",assetTypes:[{type:"Database",displayName:"Database",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"schemaCount",displayName:"Schema Count",type:"number",required:!1}]},{type:"Schema",displayName:"Schema",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"databaseName",displayName:"Database Name",type:"string",required:!0},{name:"tableCount",displayName:"Table Count",type:"number",required:!1}]},{type:"Table",displayName:"Table",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"schemaName",displayName:"Schema Name",type:"string",required:!0},{name:"columnCount",displayName:"Column Count",type:"number",required:!1},{name:"rowCount",displayName:"Row Count",type:"number",required:!1}]},{type:"View",displayName:"View",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"schemaName",displayName:"Schema Name",type:"string",required:!0},{name:"definition",displayName:"SQL Definition",type:"string",required:!1}]},{type:"Column",displayName:"Column",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"dataType",displayName:"Data Type",type:"string",required:!0},{name:"isNullable",displayName:"Is Nullable",type:"boolean",required:!1},{name:"isPrimaryKey",displayName:"Is Primary Key",type:"boolean",required:!1}]}]},{category:"ObjectStore",displayName:"Object Store",description:"Cloud storage assets",color:"#F59E0B",assetTypes:[{type:"S3Bucket",displayName:"S3 Bucket",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"awsRegion",displayName:"AWS Region",type:"string",required:!1},{name:"objectCount",displayName:"Object Count",type:"number",required:!1}]},{type:"S3Object",displayName:"S3 Object",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"s3BucketName",displayName:"Bucket Name",type:"string",required:!0},{name:"s3ObjectKey",displayName:"Object Key",type:"string",required:!0}]},{type:"ADLSContainer",displayName:"ADLS Container",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"adlsAccountName",displayName:"Account Name",type:"string",required:!0}]},{type:"GCSBucket",displayName:"GCS Bucket",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"gcpProjectId",displayName:"GCP Project ID",type:"string",required:!1}]}]},{category:"BI",displayName:"BI",description:"Business intelligence assets",color:"#8B5CF6",assetTypes:[{type:"TableauWorkbook",displayName:"Tableau Workbook",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"siteQualifiedName",displayName:"Site",type:"string",required:!1}]},{type:"TableauDashboard",displayName:"Tableau Dashboard",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"workbookQualifiedName",displayName:"Workbook",type:"string",required:!0}]},{type:"PowerBIWorkspace",displayName:"Power BI Workspace",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0}]},{type:"PowerBIDashboard",displayName:"Power BI Dashboard",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"workspaceQualifiedName",displayName:"Workspace",type:"string",required:!0}]},{type:"LookerDashboard",displayName:"Looker Dashboard",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"sourceUrl",displayName:"Source URL",type:"string",required:!1}]}]},{category:"Dbt",displayName:"dbt",description:"dbt transformation assets",color:"#EF4444",assetTypes:[{type:"DbtModel",displayName:"dbt Model",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"dbtModelSqlAsset",displayName:"SQL Asset",type:"string",required:!1},{name:"dbtMaterialization",displayName:"Materialization",type:"enum",required:!1,enumValues:["table","view","incremental","ephemeral"]}]},{type:"DbtSource",displayName:"dbt Source",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"dbtSourceFreshness",displayName:"Freshness",type:"string",required:!1}]},{type:"DbtTest",displayName:"dbt Test",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"dbtTestStatus",displayName:"Test Status",type:"enum",required:!1,enumValues:["pass","fail","warn","error"]}]}]},{category:"DataMesh",displayName:"Data Mesh",description:"Data mesh organizational assets",color:"#10B981",assetTypes:[{type:"DataDomain",displayName:"Data Domain",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"domainOwner",displayName:"Domain Owner",type:"user",required:!1}]},{type:"DataProduct",displayName:"Data Product",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"dataDomainName",displayName:"Data Domain",type:"string",required:!0},{name:"dataProductStatus",displayName:"Status",type:"enum",required:!1,enumValues:["draft","active","deprecated"]}]}]},{category:"Airflow",displayName:"Airflow",description:"Airflow orchestration assets",color:"#06B6D4",assetTypes:[{type:"AirflowDag",displayName:"Airflow DAG",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"airflowDagSchedule",displayName:"Schedule",type:"string",required:!1}]},{type:"AirflowTask",displayName:"Airflow Task",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"airflowDagQualifiedName",displayName:"DAG",type:"string",required:!0},{name:"airflowTaskOperator",displayName:"Operator",type:"string",required:!1}]}]},{category:"API",displayName:"API",description:"API specification assets",color:"#EC4899",assetTypes:[{type:"APISpec",displayName:"API Spec",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"apiSpecVersion",displayName:"Version",type:"string",required:!1}]},{type:"APIPath",displayName:"API Path",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0},{name:"apiSpecQualifiedName",displayName:"API Spec",type:"string",required:!0},{name:"apiPathUrl",displayName:"Path URL",type:"string",required:!0}]}]},{category:"Custom",displayName:"Custom",description:"User-defined custom assets",color:"#6B7280",assetTypes:[{type:"CustomEntity",displayName:"Custom Entity",defaultAttributes:[{name:"qualifiedName",displayName:"Qualified Name",type:"string",required:!0}]}]}];function K(r){return W.find(o=>o.category===r)}function z(r,o){return K(r)?.assetTypes.find(a=>a.type===o)}const _=()=>({id:"",name:"Untitled Model",description:"",pages:[],activePageId:"",enrichmentPlans:[],domains:[],customMetadata:[],versions:[],requirementsMatrix:null,entities:[],edges:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),H=x((r,o)=>({past:[],present:_(),future:[],push:e=>{const{present:a,past:t}=o();a!==e&&r({past:[...t.slice(-49),a],present:e,future:[]})},undo:()=>{const{past:e,present:a}=o();if(e.length===0)return;const t=e[e.length-1],i=e.slice(0,-1);return r({past:i,present:t,future:[a,...o().future]}),t},redo:()=>{const{future:e,present:a}=o();if(e.length===0)return;const t=e[0],i=e.slice(1);return r({past:[...o().past,a],present:t,future:i}),t},clear:()=>{r({past:[],future:[]})},canUndo:()=>o().past.length>0,canRedo:()=>o().future.length>0}));let J=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((o,e)=>(e&=63,e<36?o+=e.toString(36):e<62?o+=(e-26).toString(36).toUpperCase():e>62?o+="-":o+="_",o),"");function L(r){return`${r.source}|${r.target}|${r.kind}|${(r.label||"").toLowerCase()}`}function P(r,o,e){const{sourceId:a,targetId:t,label:i,cardinality:n,kind:d}=e;if(!a||!t||a===t)return;const s=L({source:a,target:t,label:i,kind:d});o.existingEdgeKeys.has(s)||(o.existingEdgeKeys.add(s),r.push({id:`${a}-${t}-${J(6)}`,source:a,target:t,type:"relationship",label:i,data:{label:i,cardinality:n,kind:d},markerEnd:{type:"arrowclosed"}}))}function Y(r,o){const e=[],a=d=>o.getNodeIdByQualifiedName(d),t=d=>o.getNodeIdByGuid(d),i=d=>(d||"").toString().toLowerCase(),n=d=>i(d).includes("process");return(r||[]).forEach(d=>{const s=a(d?.qualifiedName)||t(d?.guid);if(!s)return;const m=d?.relationships||{},c=m?.inputToProcesses;Array.isArray(c)&&c.forEach(p=>{const h=a(p?.qualifiedName)||t(p?.guid);P(e,o,{sourceId:s,targetId:h,label:"input to",cardinality:"N:N",kind:"lineage"})});const g=m?.outputFromProcesses;Array.isArray(g)&&g.forEach(p=>{const h=a(p?.qualifiedName)||t(p?.guid);P(e,o,{sourceId:h,targetId:s,label:"outputs",cardinality:"N:N",kind:"lineage"})})}),(r||[]).forEach(d=>{if(!n(d?.typeName))return;const s=a(d?.qualifiedName)||t(d?.guid);if(!s)return;const m=d?.relationships||{},c=m?.inputs;Array.isArray(c)&&c.forEach(p=>{const h=a(p?.qualifiedName)||t(p?.guid);P(e,o,{sourceId:h,targetId:s,label:"input to",cardinality:"N:N",kind:"lineage"})});const g=m?.outputs;Array.isArray(g)&&g.forEach(p=>{const h=a(p?.qualifiedName)||t(p?.guid);P(e,o,{sourceId:s,targetId:h,label:"outputs",cardinality:"N:N",kind:"lineage"})})}),e}const Z={status:"idle",startedAt:null,finishedAt:null,error:null,batchesDone:0,batchesTotal:0,nodesAdded:0,edgesAdded:0,lastOptions:null},O=(r="Untitled Page")=>{const o=new Date().toISOString();return{id:y(),name:r,description:"",entities:[],edges:[],createdAt:o,updatedAt:o}},T=r=>r.pages.find(o=>o.id===r.activePageId),f=(r,o)=>({...r,pages:r.pages.map(e=>e.id===r.activePageId?o(e):e),updatedAt:new Date().toISOString()}),k=()=>{const r=O("Page 1");return{id:y(),name:"Untitled Model",description:"",pages:[r],activePageId:r.id,enrichmentPlans:[],domains:[],customMetadata:[],versions:[],requirementsMatrix:null,entities:[],edges:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};function B(r){const o=new Map,e=[],a=[],t={SQL:"SQL",BI:"BI",Glossary:"Custom",DataMesh:"DataMesh",Orchestration:"Airflow",dbt:"Dbt",Storage:"ObjectStore",Governance:"Custom",Core:"Custom",AI:"Custom",Other:"Custom"};r.entities.forEach(n=>{const d=y();o.set(n.type,d);const s=n.attributes.map(c=>({id:y(),name:c.name,displayName:c.name.charAt(0).toUpperCase()+c.name.slice(1).replace(/([A-Z])/g," $1"),type:c.type==="user[]"||c.type==="group[]"?c.type.replace("[]",""):c.type==="enum"?"enum":c.type,required:c.required,description:c.description,enumValues:c.enumValues})),m={id:d,name:n.suggestedName,displayName:n.suggestedName,category:t[n.category]||"Custom",assetType:n.type,description:"",attributes:s,relationships:[],position:n.position};e.push(m)}),r.relationships.forEach(n=>{const d=o.get(n.sourceType),s=o.get(n.targetType);if(d&&s){const m=y(),c=y(),g=e.find(p=>p.id===d);g&&g.relationships.push({id:m,name:n.label,targetEntityId:s,cardinality:n.cardinality==="1:1"?"one-to-one":n.cardinality==="N:N"?"many-to-many":"one-to-many"}),a.push({id:c,source:d,target:s,label:n.label,relationshipId:m})}});const i=O(r.name);return i.entities=e,i.edges=a,i}const u=r=>{try{const o=H.getState();o&&o.push&&o.push(r)}catch(o){console.debug("History store not ready:",o)}};let b=null;const G=x()(U($((r,o)=>({model:k(),isGalleryOpen:!1,enrichment:{...Z},selectedEntityIds:[],setSelectedEntityIds:e=>r({selectedEntityIds:e}),addPage:e=>{const a=O(e||`Page ${o().model.pages.length+1}`);return r(t=>{const i={...t.model,pages:[...t.model.pages,a],activePageId:a.id,updatedAt:new Date().toISOString()};return u(i),{model:i}}),a.id},deletePage:e=>{const{model:a}=o();if(a.pages.length<=1)return;const t=a.pages.filter(d=>d.id!==e),i=a.activePageId===e?t[0].id:a.activePageId,n={...a,pages:t,activePageId:i,updatedAt:new Date().toISOString()};r({model:n}),u(n)},setActivePage:e=>{r(a=>{const t={...a.model,activePageId:e};return u(t),{model:t}})},renamePage:(e,a)=>{r(t=>{const i={...t.model,pages:t.model.pages.map(n=>n.id===e?{...n,name:a,updatedAt:new Date().toISOString()}:n),updatedAt:new Date().toISOString()};return u(i),{model:i}})},duplicatePage:e=>{const{model:a}=o(),t=a.pages.find(p=>p.id===e);if(!t)return"";const i=new Map,n=new Map,s=t.entities.map(p=>{const h=y();i.set(p.id,h);const D=p.attributes.map(S=>({...S,id:y()})),M=p.customMetadata?.map(S=>({...S,id:y(),attributes:S.attributes.map(q=>({...q,id:y()}))})),E=p.relationships.map(S=>{const q=y();return n.set(S.id,q),{...S,id:q,targetEntityId:i.get(S.targetEntityId)||S.targetEntityId}});return{...p,id:h,attributes:D,relationships:E,customMetadata:M}}).map(p=>({...p,relationships:p.relationships.map(h=>({...h,targetEntityId:i.get(h.targetEntityId)||h.targetEntityId}))})),m=t.edges.map(p=>({...p,id:y(),source:i.get(p.source)||p.source,target:i.get(p.target)||p.target,relationshipId:p.relationshipId?n.get(p.relationshipId)||y():void 0})),c={...t,id:y(),name:`${t.name} (copy)`,entities:s,edges:m,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},g={...a,pages:[...a.pages,c],activePageId:c.id,updatedAt:new Date().toISOString()};return r({model:g}),u(g),c.id},addEntity:(e,a,t)=>{const i=y(),n=z(e,a),d=n?.defaultAttributes.map(m=>({...m,id:y()}))||[],s={id:i,name:`New ${n?.displayName||a}`,displayName:`New ${n?.displayName||a}`,category:e,assetType:a,description:"",attributes:d,relationships:[],position:t};return r(m=>{const c=f(m.model,g=>({...g,entities:[...g.entities,s],updatedAt:new Date().toISOString()}));return u(c),{model:c}}),i},importEntities:e=>{r(a=>{const t=f(a.model,i=>({...i,entities:[...i.entities,...e],updatedAt:new Date().toISOString()}));return u(t),{model:t}})},updateEntity:(e,a)=>{r(t=>{const i=f(t.model,n=>({...n,entities:n.entities.map(d=>d.id===e?{...d,...a}:d),updatedAt:new Date().toISOString()}));return u(i),{model:i}})},updateEntities:e=>{if(!e||e.length===0)return;const a=new Map;e.forEach(t=>{t?.id&&a.set(t.id,t.updates||{})}),a.size!==0&&r(t=>{const i=f(t.model,n=>({...n,entities:n.entities.map(d=>{const s=a.get(d.id);return s?{...d,...s}:d}),updatedAt:new Date().toISOString()}));return u(i),{model:i}})},deleteEntity:e=>{r(a=>{const t=f(a.model,i=>({...i,entities:i.entities.filter(n=>n.id!==e),edges:i.edges.filter(n=>n.source!==e&&n.target!==e),updatedAt:new Date().toISOString()}));return u(t),{model:t}})},addAttribute:(e,a)=>{const t={...a,id:y()};r(i=>{const n=f(i.model,d=>({...d,entities:d.entities.map(s=>s.id===e?{...s,attributes:[...s.attributes,t]}:s),updatedAt:new Date().toISOString()}));return u(n),{model:n}})},updateAttribute:(e,a,t)=>{r(i=>{const n=f(i.model,d=>({...d,entities:d.entities.map(s=>s.id===e?{...s,attributes:s.attributes.map(m=>m.id===a?{...m,...t}:m)}:s),updatedAt:new Date().toISOString()}));return u(n),{model:n}})},deleteAttribute:(e,a)=>{r(t=>{const i=f(t.model,n=>({...n,entities:n.entities.map(d=>d.id===e?{...d,attributes:d.attributes.filter(s=>s.id!==a)}:d),updatedAt:new Date().toISOString()}));return u(i),{model:i}})},bulkUpdateAttribute:(e,a)=>{r(t=>{const i=f(t.model,n=>({...n,entities:n.entities.map(d=>({...d,attributes:d.attributes.map(s=>s.name===e?{...s,...a}:s)})),updatedAt:new Date().toISOString()}));return u(i),{model:i}})},addRelationship:(e,a,t)=>{const i={...t,id:y(),targetEntityId:a},d={id:y(),source:e,target:a,label:t.name,relationshipId:i.id};r(s=>{const m=f(s.model,c=>({...c,entities:c.entities.map(g=>g.id===e?{...g,relationships:[...g.relationships,i]}:g),edges:[...c.edges,d],updatedAt:new Date().toISOString()}));return u(m),{model:m}})},updateRelationship:(e,a,t)=>{r(i=>{const n=f(i.model,d=>({...d,entities:d.entities.map(s=>s.id===e?{...s,relationships:s.relationships.map(m=>m.id===a?{...m,...t}:m)}:s),edges:d.edges.map(s=>s.relationshipId===a?{...s,label:t.name||s.label}:s),updatedAt:new Date().toISOString()}));return u(n),{model:n}})},deleteRelationship:(e,a)=>{r(t=>{const i=f(t.model,n=>({...n,entities:n.entities.map(d=>d.id===e?{...d,relationships:d.relationships.filter(s=>s.id!==a)}:d),edges:n.edges.filter(d=>d.relationshipId!==a),updatedAt:new Date().toISOString()}));return u(i),{model:i}})},addEdge:e=>{const a={...e,id:y()};r(t=>{const i=f(t.model,n=>({...n,edges:[...n.edges,a],updatedAt:new Date().toISOString()}));return u(i),{model:i}})},addEdges:e=>{e.length!==0&&r(a=>{const t=f(a.model,i=>({...i,edges:[...i.edges,...e],updatedAt:new Date().toISOString()}));return u(t),{model:t}})},deleteEdge:e=>{const a=o().getActivePage(),t=a?.edges.find(i=>i.id===e);if(t?.relationshipId&&a?.entities.find(n=>n.id===t.source)){o().deleteRelationship(t.source,t.relationshipId);return}r(i=>{const n=f(i.model,d=>({...d,edges:d.edges.filter(s=>s.id!==e),updatedAt:new Date().toISOString()}));return u(n),{model:n}})},setEntities:e=>{r(a=>{const t=f(a.model,i=>({...i,entities:e,updatedAt:new Date().toISOString()}));return u(t),{model:t}})},setEdges:e=>{r(a=>{const t=f(a.model,i=>({...i,edges:e,updatedAt:new Date().toISOString()}));return u(t),{model:t}})},updateModelInfo:e=>{r(a=>{const t={...a.model,...e,updatedAt:new Date().toISOString()};return u(t),{model:t}})},clearModel:()=>{const e=k();r({model:e}),u(e)},loadModel:e=>{if(!e.pages||e.pages.length===0){const a=O("Page 1");a.entities=e.entities||[],a.edges=e.edges||[],e={...e,pages:[a],activePageId:a.id}}e.requirementsMatrix||(e={...e,requirementsMatrix:null}),r({model:e}),u(e)},exportModel:()=>o().model,loadTemplate:e=>{const a=B(e),t={id:y(),name:e.name,description:e.description,pages:[a],activePageId:a.id,enrichmentPlans:[],domains:[],customMetadata:[],versions:[],requirementsMatrix:null,entities:[],edges:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};r({model:t,isGalleryOpen:!1}),u(t)},applyTemplateToNewPage:e=>{const{model:a}=o(),t=B(e),i={...a,pages:[...a.pages,t],activePageId:t.id,updatedAt:new Date().toISOString()};r({model:i,isGalleryOpen:!1}),u(i)},createVersion:(e,a)=>{r(t=>{const{model:i}=t,n={id:y(),name:e,description:a,timestamp:new Date().toISOString(),snapshot:JSON.stringify(i)},d={...i,versions:[...i.versions||[],n],updatedAt:new Date().toISOString()};return u(d),{model:d}})},rollbackToVersion:e=>{r(a=>{const{model:t}=a,i=t.versions?.find(n=>n.id===e);if(!i)return a;try{const n=JSON.parse(i.snapshot);return n.versions=t.versions,n.updatedAt=new Date().toISOString(),u(n),{model:n}}catch(n){return console.error("Failed to rollback to version:",n),a}})},deleteVersion:e=>{r(a=>{const{model:t}=a,i={...t,versions:(t.versions||[]).filter(n=>n.id!==e),updatedAt:new Date().toISOString()};return u(i),{model:i}})},openGallery:()=>{r({isGalleryOpen:!0})},closeGallery:()=>{r({isGalleryOpen:!1})},setRequirementsMatrix:e=>{r(a=>{const t={...a.model,requirementsMatrix:e,updatedAt:new Date().toISOString()};return u(t),{model:t}})},updateRequirementLevel:(e,a,t)=>{r(i=>{const n=i.model.requirementsMatrix;if(!n)return i;const d=n.assetTypeRequirements.map(m=>{if(m.assetType!==e)return m;const c=m.requirements.findIndex(g=>g.field===a);if(c>=0){const g=[...m.requirements];return g[c]={...g[c],requirement:t},{...m,requirements:g}}else return{...m,requirements:[...m.requirements,{field:a,requirement:t}]}}),s={...i.model,requirementsMatrix:{...n,assetTypeRequirements:d},updatedAt:new Date().toISOString()};return u(s),{model:s}})},setEnrichmentProgress:e=>{r(a=>({enrichment:{...a.enrichment,...e}}))},cancelEnrichment:()=>{b&&b.abort(),b=null,r(e=>({enrichment:{...e.enrichment,status:"cancelled",finishedAt:new Date().toISOString()}}))},enrichCanvasFromAtlan:async(e={})=>{b&&b.abort();const a=new AbortController;b=a,r(t=>({enrichment:{...t.enrichment,status:"running",startedAt:new Date().toISOString(),finishedAt:null,error:null,batchesDone:0,batchesTotal:0,nodesAdded:0,edgesAdded:0,lastOptions:e||null}}));try{if(a.signal.aborted)throw new DOMException("Aborted","AbortError");if(!(e?.includeLineage!==!1))return r(l=>({enrichment:{...l.enrichment,status:"completed",finishedAt:new Date().toISOString()}})),b=null,{nodesAdded:0,edgesAdded:0};const n=(o().getActivePage()?.entities||[]).filter(l=>!!l.atlanGuid);if(n.length===0)return r(l=>({enrichment:{...l.enrichment,status:"completed",finishedAt:new Date().toISOString()}})),b=null,{nodesAdded:0,edgesAdded:0};const d=new Set;n.forEach(l=>{const N=l.atlanRelationships||{},w=N.inputToProcesses,A=N.outputFromProcesses;Array.isArray(w)&&w.forEach(I=>I?.guid&&d.add(I.guid)),Array.isArray(A)&&A.forEach(I=>I?.guid&&d.add(I.guid))});const s=Array.from(d),m=e?.batchSize??150,c=Math.ceil(s.length/m)||1;r(l=>({enrichment:{...l.enrichment,batchesDone:0,batchesTotal:c}}));const g=s.length>0?await j({guids:s,attributes:["name","qualifiedName","__typeName"],relationAttributes:["inputs","outputs"],signal:a.signal,batchSize:m,concurrency:e?.concurrency??3,maxAttempts:e?.maxAttempts??3,baseDelayMs:e?.baseDelayMs??300,onBatchResult:({batchIndex:l,batchCount:N})=>{o().setEnrichmentProgress({batchesDone:l+1,batchesTotal:N})}}):[];if(a.signal.aborted)throw new DOMException("Aborted","AbortError");let p=0;if(g.length>0){const l=g.map(A=>({id:y(),name:A.name,type:"Process",category:"Pipeline",attributes:[],relationships:[],position:{x:Math.random()*800,y:Math.random()*600},atlanGuid:A.guid,atlanQualifiedName:A.qualifiedName,atlanTypeName:A.typeName,atlanRawAttributes:A.attributes,atlanRelationships:A.relationships})),N=new Set(n.map(A=>A.atlanGuid)),w=l.filter(A=>!N.has(A.atlanGuid));w.length>0&&(r(A=>({model:f(A.model,I=>({...I,entities:[...I.entities,...w],updatedAt:new Date().toISOString()}))})),p=w.length)}const D=o().getActivePage(),M=D?.entities||[],E=D?.edges||[],S=l=>(l||"").toString().toLowerCase(),q=new Map,C=new Map;M.forEach(l=>{const N=S(l.atlanGuid),w=S(l.atlanQualifiedName||l.qualifiedName);N&&q.set(N,l.id),w&&C.set(w,l.id)});const F=new Set(E.map(l=>L({source:l.source,target:l.target,label:l.label||"relates to",kind:l.data?.kind||"unknown"})).filter(Boolean)),V=M.filter(l=>!!l.atlanGuid).map(l=>({guid:l.atlanGuid,qualifiedName:l.atlanQualifiedName,typeName:l.atlanTypeName||l.type,attributes:l.atlanRawAttributes||{},relationships:l.atlanRelationships||{}})),Q=Y(V,{getNodeIdByGuid:l=>l?q.get(S(l)):void 0,getNodeIdByQualifiedName:l=>l?C.get(S(l)):void 0,existingEdgeKeys:F});let v=0;if(Q.length>0){const l=Q.map(N=>({id:N.id,source:N.source,target:N.target,label:N.label,relationshipId:y(),data:N.data}));r(N=>({model:f(N.model,w=>({...w,edges:[...w.edges,...l],updatedAt:new Date().toISOString()}))})),v=l.length}return b=null,r(l=>({enrichment:{...l.enrichment,status:"completed",finishedAt:new Date().toISOString(),nodesAdded:p,edgesAdded:v,batchesDone:l.enrichment.batchesTotal}})),{nodesAdded:p,edgesAdded:v}}catch(t){const i=t instanceof DOMException&&t.name==="AbortError";if(b=null,r(n=>({enrichment:{...n.enrichment,status:i?"cancelled":"error",error:i?null:t?.message||"Enrichment failed",finishedAt:new Date().toISOString()}})),!i)throw t;return{nodesAdded:0,edgesAdded:0}}},retryEnrichment:async()=>{const e=o().enrichment?.lastOptions||{};return await o().enrichCanvasFromAtlan(e)},addPlan:e=>{r(a=>{const t={...a.model,enrichmentPlans:[...a.model.enrichmentPlans||[],e],updatedAt:new Date().toISOString()};return u(t),{model:t,activePlanId:e.id}})},updatePlan:(e,a)=>{r(t=>{const i={...t.model,enrichmentPlans:(t.model.enrichmentPlans||[]).map(n=>n.id===e?{...n,...a}:n),updatedAt:new Date().toISOString()};return u(i),{model:i}})},deletePlan:e=>{r(a=>{const t={...a.model,enrichmentPlans:(a.model.enrichmentPlans||[]).filter(i=>i.id!==e),updatedAt:new Date().toISOString()};return u(t),{model:t,activePlanId:a.activePlanId===e?null:a.activePlanId}})},activePlanId:null,setActivePlanId:e=>r({activePlanId:e}),addDomain:e=>{r(a=>{const t={...a.model,domains:[...a.model.domains||[],e],updatedAt:new Date().toISOString()};return u(t),{model:t}})},setDomains:e=>{r(a=>{const t={...a.model,domains:e,updatedAt:new Date().toISOString()};return u(t),{model:t}})},updateDomain:(e,a)=>{r(t=>{const i={...t.model,domains:(t.model.domains||[]).map(n=>n.id===e?{...n,...a}:n),updatedAt:new Date().toISOString()};return u(i),{model:i}})},deleteDomain:e=>{r(a=>{const t={...a.model,domains:(a.model.domains||[]).filter(i=>i.id!==e),updatedAt:new Date().toISOString()};return u(t),{model:t}})},addCustomMetadata:e=>{r(a=>{const t={...a.model,customMetadata:[...a.model.customMetadata||[],e],updatedAt:new Date().toISOString()};return u(t),{model:t}})},updateCustomMetadata:(e,a)=>{r(t=>{const i={...t.model,customMetadata:(t.model.customMetadata||[]).map(n=>n.id===e?{...n,...a}:n),updatedAt:new Date().toISOString()};return u(i),{model:i}})},setCustomMetadata:e=>{r(a=>{const t={...a.model,customMetadata:e,updatedAt:new Date().toISOString()};return u(t),{model:t}})},deleteCustomMetadata:e=>{r(a=>{const t={...a.model,customMetadata:(a.model.customMetadata||[]).filter(i=>i.id!==e),updatedAt:new Date().toISOString()};return u(t),{model:t}})},getActivePage:()=>T(o().model),getActiveEntities:()=>T(o().model)?.entities||[],getActiveEdges:()=>T(o().model)?.edges||[]}),{name:"atlan-metadata-model",version:2,partialize:r=>({model:r.model})})));let R;G.subscribe(r=>r.model,()=>{clearTimeout(R),R=setTimeout(()=>{G.setState(r=>({model:{...r.model,updatedAt:new Date().toISOString()}}))},2e3)});export{G as u};
