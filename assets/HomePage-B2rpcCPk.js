import{c as Z,r as o,j as e,X as J,H,f as M,u as $,ap as A,aq as K,ar as ee,as as L,D as S,at as z,m as se,a8 as q,a9 as te,au as Q,av as ae,k as ne,o as k,O as W,aw as f,C as P,ac as ie,ad as R,ax as ce,G as F,ay as oe,ao as I,n as re,az as le}from"./index-BYXjn4hA.js";import{P as de,S as he,A as me}from"./AppHeader-bBOFCWJR.js";import{u as ue,g as xe}from"./pinnedWidgetsStore-BRj39sfn.js";import{A as je}from"./activity-DoilZSTg.js";import"./funnel-DPZwMpz0.js";import"./list-k-ASkxhI.js";const pe=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],Ne=Z("message-circle",pe);function ge(){const{pinnedWidgets:u,unpinWidget:l}=ue(),x=o.useMemo(()=>u.map(r=>{const h=xe(r.widgetType);if(!h)return console.warn(`Pinned widget type ${r.widgetType} not found in registry`),null;const m=h.component;return e.jsxs("div",{className:"pinned-widget-container",children:[e.jsxs("div",{className:"pinned-widget-header",children:[e.jsx("span",{className:"pinned-widget-title",children:h.title}),e.jsx("button",{className:"pinned-widget-unpin",onClick:()=>l(r.widgetType),title:"Unpin from Home",children:e.jsx(J,{size:14})})]}),e.jsx("div",{className:"pinned-widget-content",children:e.jsx(m,{widgetId:`home-pinned-${r.widgetType}`,widgetType:r.widgetType,isEditMode:!1,config:r.config})})]},r.widgetType)}),[u,l]);return u.length===0?null:e.jsxs("section",{className:"home-section pinned-widgets-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx(de,{size:16}),"Pinned Widgets"]}),e.jsx("div",{className:"pinned-widgets-grid",children:x})]})}const C={};function fe(){const u=H(),[l,x]=o.useState([]),[r,h]=o.useState(!0),[m,N]=o.useState(null),[v,j]=o.useState(new Set),[a,b]=o.useState(C),w=o.useRef(!1),{setContext:i,setLoading:n}=M(),{assetsWithScores:p,setAssetsWithScores:Ce}=$(),T=o.useMemo(()=>{const s={};return p.forEach(({asset:t,scores:c})=>{const d=t.connectionName||"Unknown";s[d]||(s[d]={score:0,count:0,critical:0}),s[d].score+=c.overall,s[d].count+=1,c.overall<40&&(s[d].critical+=1)}),Object.keys(s).forEach(t=>{s[t].count>0&&(s[t].score=Math.round(s[t].score/s[t].count))}),s},[p]),B=o.useMemo(()=>({...a,...T}),[a,T]),D=o.useCallback(async s=>{if(v.has(s.name))return;const t=C[s.name];if(!(t&&Date.now()-t.computedAt<300*1e3)){j(c=>new Set(c).add(s.name));try{const c=await A("connection",{connectionName:s.name},{limit:100});if(c.length>0){let d=0,y=0,g=0;c.forEach(_=>{try{const X=K(_),E=ee(X);d+=E.overall,g++,E.overall<40&&y++}catch{}});const Y=g>0?Math.round(d/g):0;C[s.name]={score:Y,count:g,critical:y,computedAt:Date.now()},b({...C})}}catch(c){console.error(`Failed to compute scores for ${s.name}:`,c)}finally{j(c=>{const d=new Set(c);return d.delete(s.name),d})}}},[v]);o.useEffect(()=>{L().then(x).catch(console.error).finally(()=>h(!1))},[]),o.useEffect(()=>{l.length>0&&!w.current&&(w.current=!0,l.slice(0,6).filter(t=>{const c=C[t.name];return!c||Date.now()-c.computedAt>300*1e3}).forEach((t,c)=>{setTimeout(()=>D(t),c*500)}))},[l,D]);const G=s=>{const t=s.toLowerCase();return t.includes("snowflake")?e.jsx(he,{size:28}):t.includes("bigquery")||t.includes("postgres")||t.includes("databricks")?e.jsx(S,{size:28}):e.jsx(te,{size:28})},O=s=>s>=80?"excellent":s>=60?"good":s>=40?"fair":"poor",U=s=>s>=80?"Excellent":s>=60?"Good":s>=40?"Fair":"Needs Work",V=async s=>{N(s.name),n(!0);try{const t=Q("connection",{connectionName:s.name}),c=await A("connection",{connectionName:s.name});i("connection",{connectionName:s.name},t,c),u("/dashboard")}catch(t){console.error("Failed to load context:",t)}n(!1),N(null)};return r?e.jsxs("section",{className:"home-section connection-cards-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx(S,{size:16}),"Your Connections"]}),e.jsxs("div",{className:"connection-cards-loading",children:[e.jsx(z,{size:24,className:"spin"}),e.jsx("span",{children:"Loading connections..."})]})]}):l.length===0?null:e.jsxs("section",{className:"home-section connection-cards-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx(S,{size:16}),"Your Connections"]}),e.jsx("button",{className:"refresh-btn",onClick:()=>{h(!0),L().then(x).finally(()=>h(!1))},title:"Refresh connections",children:e.jsx(se,{size:14})})]}),e.jsx("div",{className:"connection-cards-grid",children:l.slice(0,6).map(s=>{const t=B[s.name],c=t?.score||0,d=O(c),y=t&&t.count>0,g=v.has(s.name);return e.jsxs("div",{className:`connection-card ${y?d:""}`,children:[e.jsxs("div",{className:"connection-card-header",children:[e.jsx("div",{className:"connection-icon",children:G(s.name)}),e.jsxs("div",{className:"connection-info",children:[e.jsx("h3",{className:"connection-name",children:s.name}),e.jsxs("span",{className:"connection-count",children:[s.assetCount.toLocaleString()," assets"]})]})]}),e.jsx("div",{className:"connection-card-body",children:g?e.jsxs("div",{className:"computing-score",children:[e.jsx(z,{size:16,className:"spin"}),e.jsx("span",{children:"Computing scores..."})]}):y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"score-display",children:[e.jsx("span",{className:"score-value",children:c}),e.jsx("span",{className:"score-label",children:U(c)})]}),e.jsx("div",{className:"score-bar",children:e.jsx("div",{className:`score-bar-fill ${d}`,style:{width:`${c}%`}})}),t.critical>0&&e.jsxs("div",{className:"critical-badge",children:[t.critical," critical"]})]}):e.jsxs("div",{className:"no-score",children:[e.jsx("span",{children:"No scores yet"}),e.jsx("span",{className:"no-score-hint",children:"Click explore to analyze"})]})}),e.jsx("button",{className:"explore-btn",onClick:()=>V(s),disabled:m===s.name||g,children:m===s.name?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:14,className:"spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:["Explore",e.jsx(q,{size:14})]})})]},s.id)})})]})}function ve(){const u=H(),[l,x]=o.useState([]),[r,h]=o.useState(!0),[m,N]=o.useState(null),{setContext:v,setLoading:j}=M(),{stats:a}=$();o.useEffect(()=>{L().then(x).catch(console.error).finally(()=>h(!1))},[]);const b=o.useMemo(()=>{const i=[];return l.slice(0,3).forEach(n=>{const p=n.name.toLowerCase();p.includes("snowflake")?i.push({id:`q-${n.id}`,question:"How does my Snowflake look today?",contextType:"connection",connectionName:n.name,description:`Analyze ${n.assetCount.toLocaleString()} assets in ${n.name}`}):p.includes("bigquery")?i.push({id:`q-${n.id}`,question:"What's the health of my BigQuery?",contextType:"connection",connectionName:n.name,description:`Check quality across ${n.assetCount.toLocaleString()} assets`}):p.includes("redshift")?i.push({id:`q-${n.id}`,question:"How's my Redshift warehouse doing?",contextType:"connection",connectionName:n.name,description:`Review ${n.assetCount.toLocaleString()} assets`}):p.includes("databricks")?i.push({id:`q-${n.id}`,question:"Show me Databricks quality metrics",contextType:"connection",connectionName:n.name,description:`Explore ${n.assetCount.toLocaleString()} assets`}):i.push({id:`q-${n.id}`,question:`How's ${n.name} performing?`,contextType:"connection",connectionName:n.name,description:`Analyze ${n.assetCount.toLocaleString()} assets`})}),a.totalAssets>0&&i.push({id:"q-all",question:"What needs attention across my data?",contextType:"all",description:"Review critical assets and quality issues"}),a.criticalCount>0&&i.push({id:"q-critical",question:"Which assets need urgent improvement?",contextType:"all",description:`${a.criticalCount} assets below quality threshold`}),i.slice(0,4)},[l,a]),w=async i=>{N(i.id),j(!0);try{if(i.contextType==="connection"&&i.connectionName){const n=Q("connection",{connectionName:i.connectionName}),p=await A("connection",{connectionName:i.connectionName});v("connection",{connectionName:i.connectionName},n,p)}u("/dashboard")}catch(n){console.error("Failed to process question:",n)}j(!1),N(null)};return r||b.length===0?null:e.jsxs("section",{className:"home-section smart-questions-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx(ae,{size:16}),"Quick Questions"]}),e.jsx("p",{className:"section-subtitle",children:"Click a question to explore your data"}),e.jsx("div",{className:"smart-questions-grid",children:b.map(i=>e.jsxs("button",{className:`smart-question-card ${m===i.id?"loading":""}`,onClick:()=>w(i),disabled:m!==null,children:[e.jsx("div",{className:"smart-question-icon",children:e.jsx(Ne,{size:20})}),e.jsxs("div",{className:"smart-question-content",children:[e.jsx("span",{className:"smart-question-text",children:i.question}),e.jsx("span",{className:"smart-question-description",children:i.description})]}),e.jsx("div",{className:"smart-question-action",children:m===i.id?e.jsx(z,{size:16,className:"spin"}):e.jsx(q,{size:16})})]},i.id))})]})}const ye=[{icon:e.jsx(I,{size:24}),label:"Executive Dashboard",description:"Overview of metadata health",to:"/dashboard",color:"blue"},{icon:e.jsx(R,{size:24}),label:"Pivot Builder",description:"Analyze quality by dimension",to:"/pivot",color:"purple"},{icon:e.jsx(F,{size:24}),label:"Lineage Explorer",description:"Trace data relationships",to:"/lineage",color:"green"},{icon:e.jsx(le,{size:24}),label:"DaaP Analytics",description:"Data as a Product compliance",to:"/analytics",color:"orange"}];function Ae(){const{assetsWithScores:u,stats:l}=$(),{snapshots:x}=ne(),r=u.length,h=l.assetsWithDescriptions>0?l.assetsWithDescriptions/r*100:0,m=u.filter(a=>a.scores.overall<40).length,N=x.slice(0,3),j=(a=>a>=80?{label:"Healthy",color:"green",icon:e.jsx(re,{size:20})}:a>=60?{label:"Fair",color:"yellow",icon:e.jsx(je,{size:20})}:a>=40?{label:"Needs Work",color:"orange",icon:e.jsx(k,{size:20})}:{label:"Critical",color:"red",icon:e.jsx(k,{size:20})})(h);return e.jsxs("div",{className:"home-page",children:[e.jsx(me,{title:"Home"}),e.jsxs("div",{className:"home-content",children:[e.jsxs("div",{className:"hero-stats",children:[e.jsxs("div",{className:`hero-stat hero-stat-${j.color}`,children:[e.jsx("div",{className:"hero-stat-icon",children:j.icon}),e.jsxs("div",{className:"hero-stat-content",children:[e.jsxs("div",{className:"hero-stat-value",children:[Math.round(h),"%"]}),e.jsx("div",{className:"hero-stat-label",children:"Health Score"}),e.jsx("div",{className:"hero-stat-status",children:j.label})]})]}),e.jsxs("div",{className:"hero-stat",children:[e.jsx("div",{className:"hero-stat-icon",children:e.jsx(S,{size:20})}),e.jsxs("div",{className:"hero-stat-content",children:[e.jsx("div",{className:"hero-stat-value",children:r.toLocaleString()}),e.jsx("div",{className:"hero-stat-label",children:"Assets Tracked"}),e.jsx("div",{className:"hero-stat-status",children:"In current scope"})]})]}),e.jsxs("div",{className:`hero-stat ${m>0?"hero-stat-red":"hero-stat-green"}`,children:[e.jsx("div",{className:"hero-stat-icon",children:e.jsx(k,{size:20})}),e.jsxs("div",{className:"hero-stat-content",children:[e.jsx("div",{className:"hero-stat-value",children:m}),e.jsx("div",{className:"hero-stat-label",children:"Critical Assets"}),e.jsx("div",{className:"hero-stat-status",children:"Below 40% quality"})]})]}),e.jsxs("div",{className:"hero-stat",children:[e.jsx("div",{className:"hero-stat-icon",children:e.jsx(W,{size:20})}),e.jsxs("div",{className:"hero-stat-content",children:[e.jsx("div",{className:"hero-stat-value",children:x.length}),e.jsx("div",{className:"hero-stat-label",children:"Snapshots"}),e.jsx("div",{className:"hero-stat-status",children:"Quality history"})]})]})]}),e.jsx(ve,{}),e.jsx(fe,{}),e.jsx(ge,{}),e.jsxs("section",{className:"home-section",children:[e.jsx("h2",{className:"section-title",children:"Quick Actions"}),e.jsx("div",{className:"quick-actions-grid",children:ye.map(a=>e.jsxs(f,{to:a.to,className:`quick-action-card quick-action-${a.color}`,children:[e.jsx("div",{className:"quick-action-icon",children:a.icon}),e.jsxs("div",{className:"quick-action-content",children:[e.jsx("h3",{children:a.label}),e.jsx("p",{children:a.description})]}),e.jsx(q,{size:16,className:"quick-action-arrow"})]},a.to))})]}),e.jsxs("div",{className:"home-columns",children:[e.jsxs("section",{className:"home-section",children:[e.jsx("h2",{className:"section-title",children:"Recent Snapshots"}),e.jsx(P,{children:N.length>0?e.jsxs("div",{className:"recent-list",children:[N.map(a=>e.jsxs("div",{className:"recent-item",children:[e.jsx("div",{className:"recent-item-icon",children:e.jsx(ie,{size:16})}),e.jsxs("div",{className:"recent-item-content",children:[e.jsx("div",{className:"recent-item-title",children:a.label}),e.jsxs("div",{className:"recent-item-meta",children:[a.totalAssets," assets â€¢ ",Math.round(a.overallScores?.overall||0),"% quality"]})]}),e.jsx("div",{className:"recent-item-time",children:new Date(a.timestamp).toLocaleDateString()})]},a.id)),e.jsxs(f,{to:"/dashboard",className:"recent-view-all",children:["View all snapshots ",e.jsx(q,{size:14})]})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx(W,{size:32}),e.jsx("p",{children:"No snapshots yet"}),e.jsx("span",{children:"Capture your first snapshot from the dashboard"})]})})]}),e.jsxs("section",{className:"home-section",children:[e.jsx("h2",{className:"section-title",children:"Get Started"}),e.jsx(P,{children:e.jsxs("div",{className:"feature-list",children:[e.jsxs(f,{to:"/pivot",className:"feature-item",children:[e.jsx("div",{className:"feature-item-icon feature-icon-purple",children:e.jsx(R,{size:18})}),e.jsxs("div",{className:"feature-item-content",children:[e.jsx("h4",{children:"Explore by Dimension"}),e.jsx("p",{children:"Pivot quality scores by owner, domain, or schema"})]})]}),e.jsxs(f,{to:"/analytics",className:"feature-item",children:[e.jsx("div",{className:"feature-item-icon feature-icon-orange",children:e.jsx(ce,{size:18})}),e.jsxs("div",{className:"feature-item-content",children:[e.jsx("h4",{children:"DaaP Compliance"}),e.jsx("p",{children:"Check Data as a Product requirements coverage"})]})]}),e.jsxs(f,{to:"/lineage",className:"feature-item",children:[e.jsx("div",{className:"feature-item-icon feature-icon-green",children:e.jsx(F,{size:18})}),e.jsxs("div",{className:"feature-item-content",children:[e.jsx("h4",{children:"Trace Lineage"}),e.jsx("p",{children:"Visualize upstream and downstream dependencies"})]})]}),e.jsxs(f,{to:"/settings",className:"feature-item",children:[e.jsx("div",{className:"feature-item-icon feature-icon-gray",children:e.jsx(oe,{size:18})}),e.jsxs("div",{className:"feature-item-content",children:[e.jsx("h4",{children:"Configure Settings"}),e.jsx("p",{children:"Customize filters, themes, and defaults"})]})]})]})})]})]}),r===0&&e.jsxs("div",{className:"home-cta",children:[e.jsxs("div",{className:"cta-content",children:[e.jsx("h3",{children:"No assets loaded yet"}),e.jsx("p",{children:"Connect to Atlan and browse assets to get started with quality scoring"})]}),e.jsx("div",{className:"cta-actions",children:e.jsxs(f,{to:"/dashboard",className:"btn btn-primary",children:[e.jsx(I,{size:16}),"Go to Dashboard"]})})]})]})]})}export{Ae as HomePage};
