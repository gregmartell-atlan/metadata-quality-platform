import{c as ge,d as $e,p as Se,P as Ae,l as A,Q as De,V as T,W as G,Y as ne,Z as se,j as e,_ as ae,t as B,r as S,O as ve,n as Pe,$ as Me,a0 as le,f as W,u as Ne,a1 as xe,B as ke,a2 as U,a3 as Ee,R as Ve,a4 as Te,a5 as Be,D as z,a6 as be,a7 as re,a8 as Le,U as de,a9 as ie,H as Ue,I as Ge,G as ze,N as Oe,aa as Re}from"./index-BYXjn4hA.js";import{S as fe,A as Fe}from"./AppHeader-bBOFCWJR.js";import{T as Qe}from"./triangle-alert-3Hm35Ind.js";import{T as He}from"./table-BnVMzowL.js";import{H as Ie,a as te,b as J,c as me}from"./HeaderActions-DWTmbmyV.js";import{L as _e}from"./layout-template-DuBq7i-q.js";import{S as qe}from"./settings-2-CvDn4tF2.js";import{D as We}from"./download-DQhb5Itz.js";import"./funnel-DPZwMpz0.js";import"./list-k-ASkxhI.js";const Ke=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],ue=ge("chart-no-axes-column-increasing",Ke);const Ye=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],je=ge("workflow",Ye),ye=$e()(Se((n,a)=>({views:[],currentViewId:null,addView:i=>{const g=`pivot-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=new Date().toISOString(),t={...i,id:g,createdAt:r,updatedAt:r};return n(l=>({views:[...l.views,t],currentViewId:g})),g},updateView:(i,g)=>{n(r=>({views:r.views.map(t=>t.id===i?{...t,...g,updatedAt:new Date().toISOString()}:t)}))},deleteView:i=>{n(g=>({views:g.views.filter(r=>r.id!==i),currentViewId:g.currentViewId===i?null:g.currentViewId}))},setCurrentView:i=>{n({currentViewId:i})},getCurrentView:()=>{const i=a();return i.currentViewId&&i.views.find(g=>g.id===i.currentViewId)||null}}),{name:"pivot-store"}));function Ze(n){return{guid:n.guid,typeName:n.typeName,name:n.name||"",qualifiedName:n.qualifiedName||"",connectionName:n.connectionName,connectionQualifiedName:n.connectionQualifiedName,description:n.description,userDescription:n.userDescription,ownerUsers:n.ownerUsers,ownerGroups:n.ownerGroups,certificateStatus:n.certificateStatus||void 0,certificateUpdatedAt:n.certificateUpdatedAt,classificationNames:n.classificationNames,meanings:n.meanings,domainGUIDs:n.domainGUIDs,updateTime:n.updateTime,sourceUpdatedAt:n.sourceUpdatedAt,sourceLastReadAt:n.sourceLastReadAt,lastRowChangedAt:n.lastRowChangedAt,lastProfiledAt:n.lastProfiledAt,popularityScore:n.popularityScore,viewScore:n.viewScore,starredCount:n.starredCount,__hasLineage:n.__hasLineage||!1,isDiscoverable:n.isDiscoverable!==!1,isAIGenerated:n.isAIGenerated,readme:n.readme,databaseQualifiedName:n.databaseQualifiedName,schemaQualifiedName:n.schemaQualifiedName,queryCount:n.queryCount,queryUserCount:n.queryUserCount,sourceReadCount:n.sourceReadCount,sourceReadUserCount:n.sourceReadUserCount}}function Je(n){return n.connectionName||n.connectorName||"Unknown Connection"}function ce(n){if(n.typeName==="Database")return n.name||null;if(n.databaseName)return n.databaseName;if("databaseQualifiedName"in n&&n.databaseQualifiedName){const a=n.databaseQualifiedName.split("/");return a[a.length-1]||null}return null}function ee(n){if(n.typeName==="Schema")return n.name||null;if(n.schemaName)return n.schemaName;if("schemaQualifiedName"in n&&n.schemaQualifiedName){const a=n.schemaQualifiedName.split("/");return a[a.length-1]||null}return null}function L(n,a){if(n.length===0)return{completeness:0,accuracy:0,timeliness:0,consistency:0,usability:0,overall:0};let i=0,g=0,r=0,t=0,l=0;for(const p of n){const h=a.get(p.guid);h&&(i+=h.completeness,g+=h.accuracy,r+=h.timeliness,t+=h.consistency,l+=h.usability)}const v=n.length,u=Math.round(i/v),m=Math.round(g/v),N=Math.round(r/v),f=Math.round(t/v),s=Math.round(l/v),o=Math.round((u+m+N+f+s)/5);return{completeness:u,accuracy:m,timeliness:N,consistency:f,usability:s,overall:o}}function Xe(n,a){return n.filter(i=>!(a.connectionName&&i.connectionName!==a.connectionName||a.databaseName&&ce(i)!==a.databaseName||a.schemaName&&ee(i)!==a.schemaName))}function es(n,a="connection",i){const g=i?Xe(n,i):n,r=new Map;for(const u of g)r.set(u.guid,Ae(Ze(u)));if(a==="schema"&&i?.connectionName&&i?.databaseName&&i?.schemaName){const u=g.filter(s=>ee(s)===i.schemaName),m=new Map;u.forEach(s=>{const o=s.typeName||"Unknown";m.has(o)||m.set(o,[]),m.get(o).push(s)});const N=[];m.forEach((s,o)=>{const p=L(s,r);N.push({id:`${i.connectionName}-${i.databaseName}-${i.schemaName}-${o}`,label:o,level:"type",type:o,connectionName:i.connectionName,databaseName:i.databaseName,schemaName:i.schemaName,children:[],assetGuids:s.map(h=>h.guid),assetCount:s.length,metadata:p})});const f=L(u,r);return{id:`${i.connectionName}-${i.databaseName}-${i.schemaName}`,label:i.schemaName||"No Schema",level:"schema",connectionName:i.connectionName,databaseName:i.databaseName,schemaName:i.schemaName,children:N,assetGuids:u.map(s=>s.guid),assetCount:u.length,metadata:f}}if(a==="database"&&i?.connectionName&&i?.databaseName){const u=g.filter(s=>ce(s)===i.databaseName),m=new Map;u.forEach(s=>{const p=ee(s)||"_no_schema";m.has(p)||m.set(p,[]),m.get(p).push(s)});const N=[];m.forEach((s,o)=>{const p=o==="_no_schema"?null:o,h=new Map;s.forEach(y=>{const b=y.typeName||"Unknown";h.has(b)||h.set(b,[]),h.get(b).push(y)});const x=[];h.forEach((y,b)=>{const w=L(y,r);x.push({id:`${i.connectionName}-${i.databaseName}-${p||"none"}-${b}`,label:b,level:"type",type:b,connectionName:i.connectionName,databaseName:i.databaseName,schemaName:p||void 0,children:[],assetGuids:y.map(c=>c.guid),assetCount:y.length,metadata:w})});const j=L(s,r);N.push({id:`${i.connectionName}-${i.databaseName}-${p||"none"}`,label:p||"No Schema",level:"schema",connectionName:i.connectionName,databaseName:i.databaseName,schemaName:p||void 0,children:x,assetGuids:s.map(y=>y.guid),assetCount:s.length,metadata:j})});const f=L(u,r);return{id:`${i.connectionName}-${i.databaseName}`,label:i.databaseName||"No Database",level:"database",connectionName:i.connectionName,databaseName:i.databaseName,children:N,assetGuids:u.map(s=>s.guid),assetCount:u.length,metadata:f}}const t=new Map;g.forEach(u=>{const m=Je(u);t.has(m)||t.set(m,[]),t.get(m).push(u)});const l=[];t.forEach((u,m)=>{const N=new Map;u.forEach(o=>{const h=ce(o)||"_no_database";N.has(h)||N.set(h,[]),N.get(h).push(o)});const f=[];N.forEach((o,p)=>{const h=p==="_no_database"?null:p,x=new Map;o.forEach(w=>{const d=ee(w)||"_no_schema";x.has(d)||x.set(d,[]),x.get(d).push(w)});const j=[];x.forEach((w,c)=>{const d=c==="_no_schema"?null:c,C=new Map;w.forEach(M=>{const $=M.typeName||"Unknown";C.has($)||C.set($,[]),C.get($).push(M)});const k=[];C.forEach((M,$)=>{const D=L(M,r);k.push({id:`${m}-${h||"none"}-${d||"none"}-${$}`,label:$,level:"type",type:$,connectionName:m,databaseName:h||void 0,schemaName:d||void 0,children:[],assetGuids:M.map(K=>K.guid),assetCount:M.length,metadata:{completeness:D.completeness,accuracy:D.accuracy,timeliness:D.timeliness,consistency:D.consistency,usability:D.usability,overall:D.overall}})});const V=w,P=L(V,r);j.push({id:`${m}-${h||"none"}-${d||"none"}`,label:d||"No Schema",level:"schema",connectionName:m,databaseName:h||void 0,schemaName:d||void 0,children:k,assetGuids:V.map(M=>M.guid),assetCount:V.length,metadata:{completeness:P.completeness,accuracy:P.accuracy,timeliness:P.timeliness,consistency:P.consistency,usability:P.usability,overall:P.overall}})});const y=o,b=L(y,r);f.push({id:`${m}-${h||"none"}`,label:h||"No Database",level:"database",connectionName:m,databaseName:h||void 0,children:j,assetGuids:y.map(w=>w.guid),assetCount:y.length,metadata:{completeness:b.completeness,accuracy:b.accuracy,timeliness:b.timeliness,consistency:b.consistency,usability:b.usability,overall:b.overall}})});const s=L(u,r);l.push({id:m,label:m,level:"connection",connectionName:m,children:f,assetGuids:u.map(o=>o.guid),assetCount:u.length,metadata:{completeness:s.completeness,accuracy:s.accuracy,timeliness:s.timeliness,consistency:s.consistency,usability:s.usability,overall:s.overall}})});const v=L(n,r);return{id:"root",label:"All Assets",level:"connection",children:l,assetGuids:n.map(u=>u.guid),assetCount:n.length,metadata:{completeness:v.completeness,accuracy:v.accuracy,timeliness:v.timeliness,consistency:v.consistency,usability:v.usability,overall:v.overall}}}function _(n,a,i,g,r){if(performance.now(),A.info("buildDynamicPivot: Starting pivot build",{assetCount:n.length,rowDimensions:a.length,measures:i.length,hasLineageMap:!1}),a.length===0||i.length===0||n.length===0)return A.warn("buildDynamicPivot: Empty input, returning empty pivot",{hasDimensions:a.length>0,hasMeasures:i.length>0,hasAssets:n.length>0}),{headers:[],rows:[],dimensionOrder:a,measureOrder:i};const t=performance.now(),l=new Map;n.forEach(s=>{const o=[];a.forEach(h=>{const x=De(h,s)||"Unknown";o.push(x)});const p=o.join("::");l.has(p)||l.set(p,[]),l.get(p).push(s)});const v=performance.now()-t;A.debug("buildDynamicPivot: Assets grouped",{groupCount:l.size,duration:`${v.toFixed(2)}ms`});const u=performance.now(),m=[];l.forEach((s,o)=>{const p={},h=o.split("::");a.forEach((b,w)=>{p[b]=h[w]||"Unknown"});const x=performance.now(),j={};i.forEach(b=>{j[b]=T(b,s,g,r)});const y=performance.now()-x;(m.length<5||m.length%10===0)&&A.debug(`buildDynamicPivot: Calculated measures for row ${m.length+1}`,{dimensionValues:p,measureValues:j,assetCount:s.length,duration:`${y.toFixed(2)}ms`}),m.push({dimensionValues:p,assetGuids:s.map(b=>b.guid),assetCount:s.length,measures:j})});const N=performance.now()-u;A.debug("buildDynamicPivot: Rows built",{rowCount:m.length,duration:`${N.toFixed(2)}ms`}),performance.now(),m.sort((s,o)=>{for(const p of a){const h=s.dimensionValues[p]||"",x=o.dimensionValues[p]||"";if(h!==x)return h.localeCompare(x)}return 0});const f=[];return a.forEach(s=>{f.push(G(s))}),i.forEach(s=>{f.push(ne(s))}),{headers:f,rows:m,dimensionOrder:a,measureOrder:i}}function ss(n){if(n.dimensionOrder.length<2)return n.rows.map(t=>({...t,level:0,isParent:!1}));const a=n.dimensionOrder[0],i=n.dimensionOrder[1],g=new Map;n.rows.forEach(t=>{const l=t.dimensionValues[a]||"Unknown";t.dimensionValues[i];const v=l;if(!g.has(v)){const m=n.rows.filter(o=>o.dimensionValues[a]===l).flatMap(o=>o.assetGuids),N={};n.measureOrder.forEach(o=>{const p=n.rows.filter(h=>h.dimensionValues[a]===l);p.flatMap(h=>h.assetGuids),N[o]=T(o,p.flatMap(h=>h.assetGuids.map(x=>null).filter(Boolean)))});const f=n.rows.filter(o=>o.dimensionValues[a]===l),s=f.reduce((o,p)=>o+p.assetCount,0);n.measureOrder.forEach(o=>{if(o==="assetCount")N[o]=s;else{const p=f.reduce((h,x)=>h+x.measures[o]*x.assetCount,0);N[o]=s>0?Math.round(p/s):0}}),g.set(v,{dimensionValues:{[a]:l},assetGuids:m,assetCount:s,measures:N,level:0,isParent:!0,isExpanded:!0,children:[]})}g.get(v).children.push({...t,level:1,parentKey:v,isParent:!1})});const r=[];return g.forEach(t=>{r.push(t),t.isExpanded&&t.children&&r.push(...t.children)}),r}function ns(n,a,i){if(i==="visual")return!0;if(i==="numeric"||i==="percentage")return!1;const g=["completeness","accuracy","timeliness","consistency","usability","overall","avgCompleteness"],r=["descriptionCoverage","ownerCoverage","certificationCoverage","lineageCoverage","hasUpstream","hasDownstream","fullLineage"];return g.includes(n)||r.includes(n)}function oe(n,a=!0){const i=[];if((a&&n.dimensionOrder.length>=2?ss(n):n.rows.map(r=>({...r,level:0,isParent:!1}))).forEach((r,t)=>{const l=[],v=r,u=v.level||0;v.isParent,n.dimensionOrder.forEach((m,N)=>{const f=r.dimensionValues[m]||"Unknown",s=ae(m),o=N===0,p=N===1,h=u>0?`hierarchy-level-${u}`:"";o?l.push(e.jsxs("span",{className:`dim-cell ${h}`,style:{paddingLeft:u>0?`${20+(u-1)*20}px`:"0"},children:[u===0&&e.jsx("span",{className:"dim-icon connection",children:s}),u>0&&e.jsx("span",{className:"hierarchy-indent",children:e.jsx("span",{className:"hierarchy-line",children:"â”œâ”€"})}),f]},`dim-${t}-${m}`)):p&&u===1?l.push(e.jsx("span",{className:`dim-cell ${h}`,children:f},`dim-${t}-${m}`)):u===0&&l.push(e.jsx("span",{},`dim-${t}-${m}`))}),n.measureOrder.forEach(m=>{const N=r.measures[m],f=se(m,N),s=n.measureDisplayModes?.get(m)||"auto";ns(m,N,s)?l.push(e.jsxs("div",{className:"bar-cell",children:[e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:`bar-fill ${B(N)}`,style:{width:`${N}%`}})}),e.jsx("span",{className:"bar-value",children:f})]},`measure-${t}-${m}`)):s==="percentage"&&m!=="assetCount"?l.push(`${N}%`):l.push(f)}),i.push(l)}),n.rows.length>0){const r=[];n.dimensionOrder.forEach((l,v)=>{v===0?r.push(e.jsx("strong",{children:"Total"},"total-label")):r.push("â€”")});const t=n.rows.reduce((l,v)=>l+v.assetCount,0);n.measureOrder.forEach(l=>{if(l==="assetCount")r.push(e.jsx("strong",{children:t},`total-${l}`));else{const v=n.rows.reduce((m,N)=>m+N.measures[l]*N.assetCount,0),u=Math.round(v/t);r.push(e.jsx("strong",{children:se(l,u)},`total-${l}`))}}),i.push(r)}return i}function as(n){const a=new Set,i=new Map,g=new Map;return n.forEach(r=>{const t=r.connectionName||r.connectorName||"Unknown Connection";if(a.add(t),"databaseQualifiedName"in r&&r.databaseQualifiedName){const l=r.databaseName||he(r.databaseQualifiedName);if(l&&(i.has(t)||i.set(t,new Set),i.get(t).add(l),"schemaQualifiedName"in r&&r.schemaQualifiedName)){const v=r.schemaName||he(r.schemaQualifiedName);if(v){const u=`${t}::${l}`;g.has(u)||g.set(u,new Set),g.get(u).add(v)}}}}),{connections:a,databasesByConn:i,schemasByConnDb:g}}function he(n){const a=n.split("/");return a[a.length-1]||n}function ts({assets:n,filter:a,onChange:i}){const g=S.useMemo(()=>as(n),[n]),r=a.connectionName?Array.from(g.databasesByConn.get(a.connectionName)||[]).sort():[],t=a.connectionName&&a.databaseName?Array.from(g.schemasByConnDb.get(`${a.connectionName}::${a.databaseName}`)||[]).sort():[],l=s=>{const o={level:s};s==="connection"?a.connectionName&&(o.connectionName=a.connectionName):s==="database"?(a.connectionName&&(o.connectionName=a.connectionName),a.databaseName&&(o.databaseName=a.databaseName)):s==="schema"&&(o.connectionName=a.connectionName,o.databaseName=a.databaseName,o.schemaName=a.schemaName),i(o)},v=s=>{i({level:a.level,connectionName:s||void 0,databaseName:void 0,schemaName:void 0})},u=s=>{i({level:a.level,connectionName:a.connectionName,databaseName:s||void 0,schemaName:void 0})},m=s=>{i({level:a.level,connectionName:a.connectionName,databaseName:a.databaseName,schemaName:s||void 0})},N=()=>{i({level:"connection"})},f=a.connectionName||a.databaseName||a.schemaName;return e.jsxs("div",{className:"hierarchy-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsxs("label",{className:"filter-label",children:[e.jsx("span",{className:"filter-icon",children:"ðŸ”"}),"Hierarchy Filter"]}),f&&e.jsx("button",{className:"clear-filter-btn",onClick:N,title:"Clear all filters",children:"Clear"})]}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-group-label",children:"Start Level"}),e.jsxs("div",{className:"level-buttons",children:[e.jsx("button",{className:`level-btn ${a.level==="connection"?"active":""}`,onClick:()=>l("connection"),title:"Show all connections and everything below",children:"Connection"}),e.jsx("button",{className:`level-btn ${a.level==="database"?"active":""}`,onClick:()=>l("database"),disabled:!a.connectionName,title:"Show selected database and everything below (requires connection)",children:"Database"}),e.jsx("button",{className:`level-btn ${a.level==="schema"?"active":""}`,onClick:()=>l("schema"),disabled:!a.connectionName||!a.databaseName,title:"Show selected schema and everything below (requires connection + database)",children:"Schema"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-group-label",children:"Connection"}),e.jsxs("select",{value:a.connectionName||"",onChange:s=>v(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"All Connections"}),Array.from(g.connections).sort().map(s=>e.jsx("option",{value:s,children:s},s))]})]}),(a.level==="database"||a.level==="schema")&&a.connectionName&&e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-group-label",children:"Database"}),e.jsxs("select",{value:a.databaseName||"",onChange:s=>u(s.target.value),className:"filter-select",disabled:!a.connectionName,children:[e.jsx("option",{value:"",children:"All Databases"}),r.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),a.level==="schema"&&a.connectionName&&a.databaseName&&e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-group-label",children:"Schema"}),e.jsxs("select",{value:a.schemaName||"",onChange:s=>m(s.target.value),className:"filter-select",disabled:!a.connectionName||!a.databaseName,children:[e.jsx("option",{value:"",children:"All Schemas"}),t.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),f&&e.jsxs("div",{className:"filter-summary",children:[e.jsx("span",{className:"filter-summary-label",children:"Filtering by:"}),e.jsxs("span",{className:"filter-summary-value",children:[a.connectionName&&e.jsxs("span",{className:"filter-tag",children:["Connection: ",e.jsx("strong",{children:a.connectionName})]}),a.databaseName&&e.jsxs("span",{className:"filter-tag",children:["Database: ",e.jsx("strong",{children:a.databaseName})]}),a.schemaName&&e.jsxs("span",{className:"filter-tag",children:["Schema: ",e.jsx("strong",{children:a.schemaName})]})]})]})]})}function Q({title:n,subtitle:a,meta:i,rows:g,columns:r,measures:t,measureControls:l,children:v,insights:u}){return e.jsxs("div",{className:"pivot-section",children:[e.jsxs("div",{className:"pivot-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"pivot-title",children:n}),e.jsx("div",{className:"pivot-subtitle",children:a})]}),e.jsx("div",{className:"pivot-meta",children:i.map((m,N)=>e.jsxs("span",{children:[m.label," ",m.value]},N))})]}),e.jsxs("div",{className:"pivot-config",children:[e.jsxs("div",{className:"config-group",children:[e.jsx("div",{className:"config-label",children:"Rows"}),e.jsx("div",{className:"config-chips",children:g})]}),r&&e.jsxs("div",{className:"config-group",children:[e.jsx("div",{className:"config-label",children:"Columns"}),e.jsx("div",{className:"config-chips",children:r})]}),t&&e.jsxs("div",{className:"config-group",children:[e.jsx("div",{className:"config-label",children:"Measures"}),e.jsx("div",{className:"config-chips",children:t})]}),l&&e.jsx("div",{className:"config-group measure-controls",children:l})]}),e.jsx("div",{className:"pivot-body",children:v}),u&&u.length>0&&e.jsxs("div",{className:"insights-panel",children:[e.jsx("div",{className:"insights-title",children:"Key Insights"}),e.jsx("div",{className:"insights-list",children:u.map((m,N)=>e.jsxs("div",{className:"insight-item",children:[e.jsxs("span",{className:`insight-icon ${m.type}`,children:[m.type==="danger"&&e.jsx(Qe,{size:14}),m.type==="warning"&&e.jsx(ve,{size:14}),m.type==="success"&&e.jsx(Pe,{size:14}),m.type==="info"&&e.jsx(Me,{size:14})]}),e.jsx("span",{dangerouslySetInnerHTML:{__html:m.message}})]},N))})]})]})}function q({headers:n,rows:a,className:i=""}){return e.jsxs("table",{className:`data-table ${i}`,children:[e.jsx("thead",{children:e.jsx("tr",{children:n.map((g,r)=>e.jsx("th",{className:typeof g=="string"&&(g.includes("%")||g.toLowerCase().includes("numeric"))?"numeric":"",children:g},r))})}),e.jsx("tbody",{children:a.map((g,r)=>e.jsx("tr",{className:r===a.length-1?"total-row":"",children:g.map((t,l)=>e.jsx("td",{className:l===0?"dim-cell":typeof t=="number"||typeof t=="string"&&t.match(/^\d+%?$/)?"numeric":"",children:t},l))},r))})]})}const is=n=>{const a=n.toLowerCase();return a.includes("snowflake")?"â„ï¸":a.includes("bigquery")||a.includes("big query")?"ðŸ”·":a.includes("postgres")?"ðŸ˜":a.includes("tableau")?"ðŸ“Š":a.includes("dbt")?"ðŸ”¶":a.includes("databricks")?"ðŸ”·":"ðŸ”—"};function cs(n={}){const{onSave:a}=n,{selectedAssets:i}=le(),g=W(c=>c.contextAssets),{addView:r,setCurrentView:t}=ye(),{assetsWithScores:l}=Ne(),{rowDimensions:v,measures:u,measureDisplayModes:m}=xe(),[N,f]=S.useState(!1),[s,o]=S.useState({level:"connection"}),p=g.length>0?g:i,h=S.useMemo(()=>{if(l.length===0)return;const c=new Map;return l.forEach(({asset:d,scores:C})=>{c.set(d.guid,C)}),c},[l]),x=S.useMemo(()=>p.length===0?[]:p.filter(c=>!(s.connectionName&&c.connectionName!==s.connectionName||s.databaseName&&(c.typeName==="Database"?c.name:"databaseQualifiedName"in c&&c.databaseQualifiedName&&c.databaseQualifiedName.split("/").pop()||null)!==s.databaseName||s.schemaName&&(c.typeName==="Schema"?c.name:"schemaQualifiedName"in c&&c.schemaQualifiedName&&c.schemaQualifiedName.split("/").pop()||null)!==s.schemaName)),[p,s]),j=S.useMemo(()=>{if(x.length===0||v.length===0||u.length===0)return null;const c=_(x,v,u,void 0,h);return c.measureDisplayModes=m,c},[x,v,u,h,m]),y=S.useMemo(()=>j?oe(j,!0):[],[j]),b=S.useMemo(()=>x.length===0?null:es(x,s.level,{connectionName:s.connectionName,databaseName:s.databaseName,schemaName:s.schemaName}),[x,s]),w=()=>{if(!j||v.length===0||u.length===0)return;f(!0);const c=r({name:`Pivot View ${new Date().toLocaleDateString()}`,description:`Pivot view with ${x.length} asset${x.length!==1?"s":""}, grouped by ${v.map(G).join(" Ã— ")}`,hierarchy:b||{id:"root",label:"All Assets",level:"connection",children:[],assetGuids:x.map(d=>d.guid),assetCount:x.length},config:{rowDimensions:v,measures:u}});t(c),f(!1),a&&a(),Ee("Pivot view saved successfully!","success")};return p.length===0?e.jsxs("div",{className:"demo-pivots",style:{padding:"2rem",textAlign:"center"},children:[e.jsx("h2",{children:"No Assets in Context"}),e.jsx("p",{children:"Please set an asset context by dragging a connection, database, or schema into the context header above, or select assets from the Asset Browser."})]}):e.jsxs("div",{className:"demo-pivots",children:[e.jsx(ts,{assets:p,filter:s,onChange:o}),e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0},children:"Pivot Analysis"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"var(--text-muted)"},children:["Analyzing ",x.length," asset",x.length!==1?"s":"",s.level==="connection"&&s.connectionName&&` in ${s.connectionName}`,s.level==="database"&&` in database ${s.databaseName}`,s.level==="schema"&&` in schema ${s.schemaName}`]})]}),e.jsx(ke,{variant:"primary",onClick:w,disabled:N||!j,children:N?"Saving...":"Save View"})]}),j&&e.jsx(Q,{title:`Pivot: ${v.map(G).join(" Ã— ")}`,subtitle:`Analyzing ${x.length} assets by selected dimensions and measures`,meta:[{label:"ðŸ“Š",value:`${x.length} assets`},{label:"ðŸ•",value:`Updated ${new Date().toLocaleTimeString()}`}],rows:e.jsx(e.Fragment,{children:v.map(c=>e.jsxs("span",{className:"chip",children:[e.jsx("span",{className:"chip-icon",children:ae(c)}),G(c)]},c))}),measures:e.jsx(e.Fragment,{children:u.map(c=>e.jsx("span",{className:"chip",children:ne(c)},c))}),insights:[{type:"info",message:`Grouping by <strong>${v.map(G).join("</strong> Ã— <strong>")}</strong> with <strong>${u.length} measure${u.length!==1?"s":""}</strong>`}],children:e.jsx(q,{headers:j.headers,rows:y})}),!j&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-muted)"},children:x.length===0?e.jsx("p",{children:"No assets match the current filter. Adjust the hierarchy filter above."}):e.jsx("p",{children:"Select row dimensions and measures to build a pivot table."})}),b&&e.jsx(Q,{title:`Quality Scorecard: ${s.level==="connection"?"Connection":s.level==="database"?"Database":"Schema"} Ã— Dimension`,subtitle:"Heatmap showing quality scores across all five dimensions",meta:[{label:"ðŸ“Š",value:`${b.level==="connection"?b.children.length:1} ${s.level}${b.level==="connection"?"s":""}`},{label:"ðŸ•",value:`Updated ${new Date().toLocaleTimeString()}`}],rows:e.jsxs("span",{className:"chip",children:[e.jsx("span",{className:"chip-icon",children:"ðŸ”—"})," ",s.level==="connection"?"Connection":s.level==="database"?"Database":"Schema"]}),columns:e.jsx("span",{className:"chip",children:"Quality Dimensions (5)"}),children:e.jsx(q,{headers:[s.level==="connection"?"Connection":s.level==="database"?"Database":"Schema","Completeness","Accuracy","Timeliness","Consistency","Usability","Overall"],rows:(b.level==="connection"?b.children:[b]).map(c=>[e.jsxs("span",{children:[e.jsx("span",{className:"dim-icon connection",children:c.level==="connection"?is(c.label):c.level==="database"?"ðŸ—„ï¸":"ðŸ“"}),c.label]},`node-${c.id}`),e.jsx("span",{className:`heat-cell ${U(c.metadata?.completeness||0)}`,children:c.metadata?.completeness||0},`comp-${c.id}`),e.jsx("span",{className:`heat-cell ${U(c.metadata?.accuracy||0)}`,children:c.metadata?.accuracy||0},`acc-${c.id}`),e.jsx("span",{className:`heat-cell ${U(c.metadata?.timeliness||0)}`,children:c.metadata?.timeliness||0},`time-${c.id}`),e.jsx("span",{className:`heat-cell ${U(c.metadata?.consistency||0)}`,children:c.metadata?.consistency||0},`cons-${c.id}`),e.jsx("span",{className:`heat-cell ${U(c.metadata?.usability||0)}`,children:c.metadata?.usability||0},`use-${c.id}`),e.jsx("span",{className:`score-cell ${B(c.metadata?.overall||0)}`,children:c.metadata?.overall||0},`overall-${c.id}`)])})})]})}function os(n){const a=n.toLowerCase();return a.includes("snowflake")?e.jsx(fe,{size:16}):a.includes("bigquery")||a.includes("big query")?e.jsx(z,{size:16}):a.includes("postgres")?e.jsx(z,{size:16}):a.includes("tableau")?e.jsx(be,{size:16}):a.includes("dbt")?e.jsx(je,{size:16}):a.includes("databricks")?e.jsx(z,{size:16}):e.jsx(z,{size:16})}function pe({data:n,assets:a,className:i=""}){const[g,r]=S.useState(new Set),t=(s,o,p=[])=>{if(o>=n.dimensionOrder.length)return[];const h=n.dimensionOrder[o],x=new Map;s.forEach(y=>{const w=y.dimensionValues[h]||"Unknown";x.has(w)||x.set(w,[]),x.get(w).push(y)});const j=[];return x.forEach((y,b)=>{const w=[...p,`${h}::${b}`],c=w.join("::"),d=y.flatMap(D=>D.assetGuids),C=a.filter(D=>d.includes(D.guid)),k={};n.measureOrder.forEach(D=>{D==="assetCount"?k[D]=C.length:k[D]=T(D,C)});const V={};y.length>0&&Object.assign(V,y[0].dimensionValues),V[h]=b;const P=o<n.dimensionOrder.length-1,M=P?y:[],$={dimensionValues:V,assetGuids:d,assetCount:C.length,measures:k,level:o,isParent:P,rowKey:c,children:[],childRows:M};P&&($.children=t(y,o+1,w)),j.push($)}),j},l=s=>{const o=[];return s.forEach(p=>{o.push(p),p.isParent&&g.has(p.rowKey)&&o.push(...l(p.children))}),o},v=S.useMemo(()=>t(n.rows,0),[n,a]),u=S.useMemo(()=>l(v),[v,g]);Ve.useEffect(()=>{const s=new Set,o=p=>{p.forEach(h=>{h.isParent&&(s.add(h.rowKey),o(h.children))})};o(v),r(s)},[v]);const m=s=>{const o=new Set(g);o.has(s)?o.delete(s):o.add(s),r(o)},N=[];n.dimensionOrder.length>0&&N.push(n.dimensionOrder.map(G).join(" / ")),n.measureOrder.forEach(s=>{N.push(ne(s))});const f=s=>s===0?null:e.jsxs("span",{className:"hierarchy-indent-line",children:["â”‚  ".repeat(s-1),"â”œâ”€"," "]});return e.jsxs("table",{className:`data-table hierarchical-table ${i}`,children:[e.jsx("thead",{children:e.jsx("tr",{children:N.map((s,o)=>e.jsx("th",{className:typeof s=="string"&&(s.includes("%")||s.toLowerCase().includes("numeric"))?"numeric":"",children:s},o))})}),e.jsxs("tbody",{children:[u.map(s=>{const o=s.isParent,p=s.level,h=o&&s.children.length>0,x=g.has(s.rowKey),j=n.dimensionOrder[p],y=s.dimensionValues[j]||"Unknown";return e.jsxs("tr",{className:`hierarchy-row level-${p} ${o?"parent-row":"child-row"}`,children:[e.jsx("td",{className:"dim-cell hierarchy-cell",children:e.jsxs("div",{className:"hierarchy-content",style:{paddingLeft:`${p*24}px`},children:[o&&h&&e.jsx("button",{className:"expand-toggle",onClick:()=>m(s.rowKey),"aria-label":x?"Collapse":"Expand",children:x?e.jsx(Te,{size:14}):e.jsx(Be,{size:14})}),!o&&p>0&&f(p),p===0&&e.jsx("span",{className:"dim-icon connection",children:j==="connection"?os(y):ae(j)}),e.jsx("span",{className:"dim-value",children:y})]})}),n.measureOrder.map(b=>{const w=s.measures[b],c=se(b,w),d=n.measureDisplayModes?.get(b)||"auto";return d==="visual"||d==="auto"&&["completeness","accuracy","timeliness","consistency","usability","overall","avgCompleteness","descriptionCoverage","ownerCoverage","certificationCoverage","lineageCoverage","hasUpstream","hasDownstream","fullLineage"].includes(b)?e.jsx("td",{className:"numeric",children:e.jsxs("div",{className:"bar-cell",children:[e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:`bar-fill ${B(w)}`,style:{width:`${w}%`}})}),e.jsx("span",{className:"bar-value",children:c})]})},`measure-${s.rowKey}-${b}`):d==="percentage"&&b!=="assetCount"?e.jsxs("td",{className:"numeric",children:[w,"%"]},`measure-${s.rowKey}-${b}`):e.jsx("td",{className:"numeric",children:c},`measure-${s.rowKey}-${b}`)})]},s.rowKey)}),n.rows.length>0&&e.jsxs("tr",{className:"total-row",children:[e.jsx("td",{className:"dim-cell",children:e.jsx("strong",{children:"Total"})}),n.measureOrder.map(s=>{const o=n.rows.reduce((p,h)=>p+h.assetCount,0);if(s==="assetCount")return e.jsx("td",{className:"numeric",children:e.jsx("strong",{children:o})},`total-${s}`);{const p=n.rows.reduce((x,j)=>x+j.measures[s]*j.assetCount,0),h=o>0?Math.round(p/o):0;return e.jsx("td",{className:"numeric",children:e.jsx("strong",{children:se(s,h)})},`total-${s}`)}})]})]})]})}const ls=n=>{const a=n.toLowerCase();return a.includes("snowflake")?e.jsx(fe,{size:16}):a.includes("bigquery")||a.includes("big query")?e.jsx(z,{size:16}):a.includes("postgres")?e.jsx(z,{size:16}):a.includes("tableau")?e.jsx(be,{size:16}):a.includes("dbt")?e.jsx(je,{size:16}):a.includes("databricks")?e.jsx(z,{size:16}):e.jsx(ie,{size:16})};function rs(){const{selectedAssets:n}=le(),a=W(c=>c.contextAssets),i=W(c=>c.context),g=W(c=>c.getAssetCount),{assetsWithScores:r}=Ne(),t=a.length>0?a:n,l=S.useMemo(()=>{if(r.length===0)return;const c=new Map;return r.forEach(({asset:d,scores:C})=>{c.set(d.guid,C)}),c},[r]);S.useEffect(()=>{A.info("PreBuiltPivots: Asset source check",{contextAssetsCount:a.length,selectedAssetsCount:n.length,sourceAssetsCount:t.length,hasContext:!!i,contextType:i?.type,contextLabel:i?.label,assetCount:g()})},[a,n,t,i,g]);const{rowDimensions:v,measures:u,measureDisplayModes:m}=xe(),N=S.useMemo(()=>{if(t.length>0&&!l)return A.debug("PreBuiltPivots: Waiting for scores before building custom pivot"),null;const c=performance.now();if(A.info("PreBuiltPivots: Building custom pivot",{assetCount:t.length,rowDimensions:v.length,measures:u.length}),t.length===0||v.length===0||u.length===0)return A.debug("PreBuiltPivots: Skipping custom pivot (empty input)"),null;const d=_(t,v,u,void 0,l);d.measureDisplayModes=m;const C=performance.now()-c;return A.info("PreBuiltPivots: Custom pivot built",{rowCount:d.rows.length,duration:`${C.toFixed(2)}ms`}),d},[t,v,u,m,l]),f=S.useMemo(()=>N?oe(N,!0):[],[N]),s=S.useMemo(()=>{if(t.length>0&&!l)return A.debug("PreBuiltPivots: Waiting for scores before building completeness pivot"),null;const c=performance.now();if(A.info("PreBuiltPivots: Building completeness pivot",{assetCount:t.length}),t.length===0)return A.debug("PreBuiltPivots: Skipping completeness pivot (no assets)"),null;const d=_(t,["connection","type"],["assetCount","descriptionCoverage","ownerCoverage","avgCompleteness"],void 0,l),C=performance.now()-c;return A.info("PreBuiltPivots: Completeness pivot built",{rowCount:d.rows.length,duration:`${C.toFixed(2)}ms`}),d},[t,l]);S.useMemo(()=>s?oe(s,!0):[],[s]);const o=S.useMemo(()=>{if(t.length>0&&!l)return A.debug("PreBuiltPivots: Waiting for scores before building domain pivot"),null;const c=performance.now();if(A.info("PreBuiltPivots: Building domain pivot",{assetCount:t.length}),t.length===0)return A.debug("PreBuiltPivots: Skipping domain pivot (no assets)"),null;const d=_(t,["domain"],["completeness","accuracy","timeliness","consistency","usability","overall"],void 0,l),C=performance.now()-c;return A.info("PreBuiltPivots: Domain pivot built",{rowCount:d.rows.length,duration:`${C.toFixed(2)}ms`}),d},[t,l]),p=S.useMemo(()=>{if(!o)return[];const c=[];return o.rows.forEach(d=>{const C=d.dimensionValues.domain||"No Domain",k=[e.jsxs("span",{className:"dim-cell",children:[e.jsx(re,{size:16,className:"dim-icon domain"}),C]},"domain"),e.jsx("span",{className:`heat-cell ${U(d.measures.completeness||0)}`,children:d.measures.completeness||0},"comp"),e.jsx("span",{className:`heat-cell ${U(d.measures.accuracy||0)}`,children:d.measures.accuracy||0},"acc"),e.jsx("span",{className:`heat-cell ${U(d.measures.timeliness||0)}`,children:d.measures.timeliness||0},"time"),e.jsx("span",{className:`heat-cell ${U(d.measures.consistency||0)}`,children:d.measures.consistency||0},"cons"),e.jsx("span",{className:`heat-cell ${U(d.measures.usability||0)}`,children:d.measures.usability||0},"use"),e.jsx("span",{className:`score-cell ${B(d.measures.overall||0)}`,children:d.measures.overall||0},"overall"),e.jsxs("span",{className:"trend flat",children:[e.jsx(Le,{size:12,style:{display:"inline",verticalAlign:"middle"}})," 0%"]},"trend")];c.push(k)}),c},[o]),h=S.useMemo(()=>t.length>0&&!l?(A.debug("PreBuiltPivots: Waiting for scores before building owner pivot"),null):t.length===0?null:_(t,["ownerGroup"],["assetCount"],void 0,l),[t,l]),x=S.useMemo(()=>{if(!h)return[];const c=[];h.rows.forEach($=>{const D=$.dimensionValues.ownerGroup||"Unowned",K=$.assetGuids,O=t.filter(E=>K.includes(E.guid)),X=O.filter(E=>E.certificateStatus==="VERIFIED").length,R=O.filter(E=>E.certificateStatus==="DRAFT").length,Y=O.filter(E=>E.certificateStatus==="DEPRECATED").length,Z=O.filter(E=>!E.certificateStatus||E.certificateStatus===null).length,F=O.length,H=F>0?Math.round(X/F*100):0,I=[e.jsxs("span",{className:"dim-cell",children:[e.jsx(de,{size:16,className:"dim-icon owner"}),D]},"owner"),e.jsx("span",{className:"center numeric",children:X},"cert"),e.jsx("span",{className:"center numeric",children:R},"draft"),e.jsx("span",{className:"center numeric",children:Y},"dep"),e.jsx("span",{className:"center numeric",children:Z},"none"),e.jsx("span",{className:"numeric",children:e.jsx("strong",{children:F})},"total"),e.jsxs("span",{className:`score-cell ${B(H)}`,children:[H,"%"]},"rate")];c.push(I)});const d=t.filter($=>$.certificateStatus==="VERIFIED").length,C=t.filter($=>$.certificateStatus==="DRAFT").length,k=t.filter($=>$.certificateStatus==="DEPRECATED").length,V=t.filter($=>!$.certificateStatus||$.certificateStatus===null).length,P=t.length,M=P>0?Math.round(d/P*100):0;return c.push([e.jsx("strong",{children:"Total"},"total-label"),e.jsx("span",{className:"center numeric",children:e.jsx("strong",{children:d})},"total-cert"),e.jsx("span",{className:"center numeric",children:e.jsx("strong",{children:C})},"total-draft"),e.jsx("span",{className:"center numeric",children:e.jsx("strong",{children:k})},"total-dep"),e.jsx("span",{className:"center numeric",children:e.jsx("strong",{children:V})},"total-none"),e.jsx("span",{className:"numeric",children:e.jsx("strong",{children:P})},"total-assets"),e.jsx("span",{className:`score-cell ${B(M)}`,children:e.jsxs("strong",{children:[M,"%"]})},"total-rate")]),c},[h,t]),j=S.useMemo(()=>{if(t.length>0&&!l)return A.debug("PreBuiltPivots: Waiting for scores before building lineage pivot"),null;const c=performance.now();if(A.info("PreBuiltPivots: Building lineage pivot",{assetCount:t.length}),t.length===0)return A.debug("PreBuiltPivots: Skipping lineage pivot (no assets)"),null;const d=_(t,["connection","database","schema"],["assetCount","hasUpstream","hasDownstream","fullLineage","orphaned"],void 0,l),C=performance.now()-c;return A.info("PreBuiltPivots: Lineage pivot built",{rowCount:d.rows.length,duration:`${C.toFixed(2)}ms`}),d},[t,l]),y=S.useMemo(()=>{if(!j)return[];const c=[];j.rows.forEach($=>{const D=$.dimensionValues.connection||"Unknown",K=$.dimensionValues.database||"â€”",O=$.dimensionValues.schema||"â€”",X=$.assetGuids,R=t.filter(Ce=>X.includes(Ce.guid)),Y=T("hasUpstream",R),Z=T("hasDownstream",R),F=T("fullLineage",R),H=T("orphaned",R),I=R.length,E=I>0?Math.round((I-H)/I*100):0,we=[e.jsxs("span",{className:"dim-cell",children:[e.jsx("span",{className:"dim-icon connection",children:ls(D)}),D]},"conn"),e.jsxs("span",{className:"dim-cell",children:[e.jsx(z,{size:14,style:{opacity:.6,marginRight:4}}),K]},"db"),e.jsxs("span",{className:"dim-cell",children:[e.jsx(He,{size:14,style:{opacity:.6,marginRight:4}}),O]},"schema"),e.jsx("span",{className:"numeric",children:I},"total"),e.jsxs("div",{className:"bar-cell",children:[e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:`bar-fill ${B(Y)}`,style:{width:`${Y}%`}})}),e.jsxs("span",{className:"bar-value",children:[Y,"%"]})]},"upstream"),e.jsxs("div",{className:"bar-cell",children:[e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:`bar-fill ${B(Z)}`,style:{width:`${Z}%`}})}),e.jsxs("span",{className:"bar-value",children:[Z,"%"]})]},"downstream"),e.jsxs("div",{className:"bar-cell",children:[e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:`bar-fill ${B(F)}`,style:{width:`${F}%`}})}),e.jsxs("span",{className:"bar-value",children:[F,"%"]})]},"full"),e.jsx("span",{className:`numeric ${H>0?"text-danger":""}`,children:H},"orphaned"),e.jsxs("span",{className:`score-cell ${B(E)}`,children:[E,"%"]},"coverage")];c.push(we)});const d=t.length,C=T("orphaned",t),k=d>0?Math.round((d-C)/d*100):0,V=T("hasUpstream",t),P=T("hasDownstream",t),M=T("fullLineage",t);return c.push([e.jsx("strong",{children:"Total"},"total-label"),e.jsx("span",{},"total-db"),e.jsx("span",{},"total-schema"),e.jsx("span",{className:"numeric",children:e.jsx("strong",{children:d})},"total-assets"),e.jsxs("strong",{children:[V,"%"]},"total-upstream"),e.jsxs("strong",{children:[P,"%"]},"total-downstream"),e.jsxs("strong",{children:[M,"%"]},"total-full"),e.jsx("span",{className:`numeric ${C>0?"text-danger":""}`,children:e.jsx("strong",{children:C})},"total-orphaned"),e.jsx("span",{className:`score-cell ${B(k)}`,children:e.jsxs("strong",{children:[k,"%"]})},"total-coverage")]),c},[j,t]),b=!!i&&i.type!==null,w=t.length>0;return A.debug("PreBuiltPivots: Rendering check",{hasContext:b,hasAssets:w,sourceAssetsCount:t.length,contextType:i?.type,contextLabel:i?.label}),w?e.jsxs("div",{className:"pre-built-pivots",children:[N&&f.length>0&&e.jsx(Q,{title:`Custom Pivot: ${v.map(G).join(" Ã— ")}`,subtitle:`Analyzing ${t.length} assets by your selected dimensions and measures`,meta:[{label:"ðŸ“Š",value:`${t.length} assets`},{label:"ðŸ•",value:`Updated ${new Date().toLocaleTimeString()}`}],rows:e.jsx(e.Fragment,{children:v.map(c=>e.jsxs("span",{className:"chip",children:[e.jsx("span",{className:"chip-icon",children:ae(c)}),G(c)]},c))}),measures:e.jsx(e.Fragment,{children:u.map(c=>e.jsx("span",{className:"chip",children:ne(c)},c))}),insights:[{type:"info",message:`Grouping by <strong>${v.map(G).join("</strong> Ã— <strong>")}</strong> with <strong>${u.length} measure${u.length!==1?"s":""}</strong>`}],children:v.length>=2?e.jsx(pe,{data:N,assets:t}):e.jsx(q,{headers:N.headers,rows:f})}),(!N||f.length===0)&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-muted)"},children:v.length===0||u.length===0?e.jsx("p",{children:"Select row dimensions and measures above to build a custom pivot table."}):e.jsx("p",{children:"No data available for the selected dimensions and measures."})}),e.jsx("div",{className:"section-divider",children:e.jsx("span",{children:"Pre-Built Analysis Views"})}),s&&e.jsx(Q,{title:"Completeness by Connection & Asset Type",subtitle:"Which source systems and asset types need the most documentation work?",meta:[{label:"ðŸ“Š",value:`${t.length} assets`},{label:"ðŸ•",value:`Updated ${new Date().toLocaleTimeString()}`}],rows:e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"chip",children:[e.jsx("span",{className:"chip-icon",children:"ðŸ”—"})," Connection"]}),e.jsxs("span",{className:"chip",children:[e.jsx("span",{className:"chip-icon",children:"ðŸ“¦"})," Asset Type"]})]}),measures:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"chip",children:"# Assets"}),e.jsx("span",{className:"chip",children:"% with Description"}),e.jsx("span",{className:"chip",children:"% with Owner"}),e.jsx("span",{className:"chip",children:"Avg Completeness"})]}),insights:[{type:"info",message:`Analyzing completeness metrics across ${s.rows.length} connection/type combinations`}],children:e.jsx(pe,{data:s,assets:t})}),e.jsx("div",{className:"section-divider",children:e.jsx("span",{children:"Domain Health Pivots"})}),o&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Quality Scorecard: Domain Ã— Dimension",subtitle:"Heatmap showing quality scores across all five dimensions by business domain",meta:[{label:e.jsx(ue,{size:14}),value:`${o.rows.length} domains`},{label:e.jsx(ve,{size:14}),value:`Updated ${new Date().toLocaleTimeString()}`}],rows:e.jsxs("span",{className:"chip",children:[e.jsx(re,{size:14,className:"chip-icon"})," Domain"]}),columns:e.jsx("span",{className:"chip",children:"Quality Dimensions (5)"}),insights:[{type:"info",message:`Analyzing quality across ${o.rows.length} business domains`}],children:e.jsx(q,{headers:["Domain","Completeness","Accuracy","Timeliness","Consistency","Usability","Overall","Î” 30d"],rows:p})}),e.jsxs("div",{className:"legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"var(--score-excellent)"}}),"Excellent (80+)"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"var(--score-good)"}}),"Good (60-79)"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"var(--score-fair)"}}),"Fair (40-59)"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"var(--score-poor)"}}),"Poor (20-39)"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"var(--score-critical)"}}),"Critical (0-19)"]})]})]}),e.jsx("div",{className:"section-divider",children:e.jsx("span",{children:"Accountability Pivots"})}),h&&x.length>0&&e.jsx(Q,{title:"Owner Accountability: Certification Coverage",subtitle:"Who is certifying their assets vs. leaving them in draft or unverified state?",meta:[{label:"ðŸ“Š",value:`${t.length} assets`},{label:"ðŸ‘¥",value:`${h.rows.length} owner groups`}],rows:e.jsxs("span",{className:"chip",children:[e.jsx(de,{size:14,className:"chip-icon"})," Owner Group"]}),columns:e.jsx("span",{className:"chip",children:"Certification Status"}),insights:[{type:"info",message:`Tracking certification status across ${h.rows.length} owner groups`}],children:e.jsx(q,{headers:["Owner Group",e.jsx("span",{className:"status-badge certified",children:"âœ“ Certified"},"cert"),e.jsx("span",{className:"status-badge draft",children:"â— Draft"},"draft"),e.jsx("span",{className:"status-badge deprecated",children:"âœ— Deprecated"},"dep"),e.jsx("span",{className:"status-badge none",children:"â—‹ None"},"none"),"Total","Cert Rate"],rows:x})}),e.jsx("div",{className:"section-divider",children:e.jsx("span",{children:"Lineage & Supply Chain"})}),j&&y.length>0&&e.jsx(Q,{title:"Lineage Coverage: Source Systems",subtitle:"Which connections have documented lineage vs. orphaned assets?",meta:[{label:e.jsx(ue,{size:14}),value:`${t.length} assets`},{label:e.jsx(ie,{size:14}),value:`${j.rows.length} connections`}],rows:e.jsxs("span",{className:"chip",children:[e.jsx(ie,{size:14,className:"chip-icon"})," Connection"]}),measures:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"chip",children:"Has Upstream"}),e.jsx("span",{className:"chip",children:"Has Downstream"}),e.jsx("span",{className:"chip",children:"Full Lineage"}),e.jsx("span",{className:"chip",children:"Orphaned"})]}),insights:[{type:"info",message:`Analyzing lineage coverage across ${j.rows.length} source systems`}],children:e.jsx(q,{headers:["Connection","Database","Schema","Total","Has Upstream","Has Downstream","Full Lineage",e.jsx("span",{style:{color:"var(--accent-danger)"},children:"Orphaned âš "},"orphaned"),"Coverage"],rows:y})})]}):e.jsxs("div",{className:"pre-built-pivots-empty",children:[e.jsx("h2",{children:"No Assets in Context"}),e.jsx("p",{children:b?`Context is set (${i?.label}) but no assets were loaded. Please try refreshing or selecting a different context.`:"Please set an asset context by dragging a connection, database, or schema into the context header, or select assets from the Asset Browser."}),b&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"6px",fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Debug Info:"}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:["Context Type: ",i?.type]}),e.jsxs("li",{children:["Context Label: ",i?.label]}),e.jsxs("li",{children:["Asset Count: ",g()]}),e.jsxs("li",{children:["Context Assets: ",a.length]}),e.jsxs("li",{children:["Selected Assets: ",n.length]})]})]})]})}function fs(){const n=Ue(),{selectedAssets:a,selectedCount:i,addAsset:g}=le(),r=W(d=>d.contextAssets),t=W(d=>d.getAssetCount),{views:l,getCurrentView:v,setCurrentView:u,deleteView:m}=ye(),[N,f]=S.useState("all"),[s,o]=S.useState(null),{toggleTab:p,activeTab:h,isOpen:x}=Ge(),j=v(),y=r.length>0?r:a;r.length>0&&t();const b=()=>{if(y.length>0){const d=y[0];g(d),n(`/lineage?guid=${d.guid}`)}},w=d=>{u(d)},c=()=>{s&&(m(s),o(null))};return e.jsxs("div",{className:"pivot-builder-page",children:[e.jsx(Fe,{title:"Pivot Builder",children:e.jsxs(Ie,{children:[e.jsxs(te,{children:[l.length>0&&e.jsx("div",{className:"header-select-wrapper",children:e.jsxs("select",{value:j?.id||"",onChange:d=>{d.target.value?w(d.target.value):u(null)},className:"view-select-minimal",title:"Load Saved View",children:[e.jsx("option",{value:"",children:"Select View..."}),l.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})}),e.jsx(J,{icon:e.jsx(_e,{}),onClick:()=>f("custom"),active:N==="custom",title:"Custom Builder"})]}),e.jsx(me,{}),e.jsxs(te,{children:[y.length>0&&e.jsx(J,{icon:e.jsx(ze,{}),onClick:b,title:"View Lineage for Context"}),e.jsx(J,{icon:e.jsx(qe,{}),onClick:()=>p("config"),active:x&&h==="config",title:"Configure Pivot"})]}),e.jsx(me,{}),e.jsxs(te,{children:[e.jsx(J,{icon:e.jsx(Oe,{}),disabled:!0,title:"Snapshot (Coming Soon)"}),e.jsx(J,{icon:e.jsx(We,{}),title:"Export to CSV"})]})]})}),e.jsxs("div",{className:"pivot-content",children:[e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${N==="all"?"active":""}`,onClick:()=>f("all"),children:"All Pivots"}),e.jsx("button",{className:`tab ${N==="accountability"?"active":""}`,onClick:()=>f("accountability"),children:"Accountability"}),e.jsx("button",{className:`tab ${N==="domain"?"active":""}`,onClick:()=>f("domain"),children:"Domain Health"}),e.jsx("button",{className:`tab ${N==="lineage"?"active":""}`,onClick:()=>f("lineage"),children:"Lineage Coverage"}),e.jsx("button",{className:`tab ${N==="custom"?"active":""}`,onClick:()=>f("custom"),children:"Custom Builder"})]}),N==="custom"?e.jsx(cs,{}):e.jsx(rs,{})]}),e.jsx(Re,{isOpen:s!==null,onClose:()=>o(null),onConfirm:c,title:"Delete Pivot View",message:"Are you sure you want to delete this pivot view? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"danger"})]})}export{fs as PivotBuilder};
